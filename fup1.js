/* Generated by the Nim Compiler v1.4.2 */
var framePtr = null;
var excHandler = 0;
var lastJSError = null;
var NTI2456005 = {size: 0,kind: 36,base: null,node: null,finalizer: null};
var NTI14505002 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI13810029 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI13785388 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI13785373 = {size: 0,kind: 20,base: null,node: null,finalizer: null};
var NTI13805029 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI13785385 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI13785371 = {size: 0,kind: 20,base: null,node: null,finalizer: null};
var NTI2456068 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI13825216 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI2456066 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI2456064 = {size: 0,kind: 1,base: null,node: null,finalizer: null};
var NTI13825211 = {size: 0,kind: 16,base: null,node: null,finalizer: null};
var NTI13825207 = {size: 0,kind: 16,base: null,node: null,finalizer: null};
var NTI13825202 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI12522033 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI12522018 = {size: 0,kind: 22,base: null,node: null,finalizer: null};
var NTI13745008 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI13745002 = {size: 0, kind: 14, base: null, node: null, finalizer: null};
var NTI14020063 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI13860428 = {size: 0,kind: 24,base: null,node: null,finalizer: null};
var NTI6855232 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI7110011 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI2462653 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI13787257 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI2456044 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI13787232 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI13785391 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI13785375 = {size: 0,kind: 20,base: null,node: null,finalizer: null};
var NTI13785382 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI13785378 = {size: 0,kind: 20,base: null,node: null,finalizer: null};
var NTI13785377 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI13815224 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI12566015 = {size: 0,kind: 43,base: null,node: null,finalizer: null};
var NTI12566202 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI2462641 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI2462408 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI2462728 = {size: 0,kind: 22,base: null,node: null,finalizer: null};
var NTI2456015 = {size: 0,kind: 29,base: null,node: null,finalizer: null};
var NTI2462723 = {size: 0,kind: 22,base: null,node: null,finalizer: null};
var NTI2462617 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI2462619 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI2462651 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI2456013 = {size: 0,kind: 28,base: null,node: null,finalizer: null};
var NTI13745013 = {size: 0, kind: 14, base: null, node: null, finalizer: null};
var NNI13745013 = {kind: 2, offset: 0, typ: null, name: null, len: 8, sons: {"0": {kind: 1, offset: 0, typ: NTI13745013, name: "tetNone", len: 0, sons: null}, 
"1": {kind: 1, offset: 1, typ: NTI13745013, name: "tetI", len: 0, sons: null}, 
"2": {kind: 1, offset: 2, typ: NTI13745013, name: "tetJ", len: 0, sons: null}, 
"3": {kind: 1, offset: 3, typ: NTI13745013, name: "tetL", len: 0, sons: null}, 
"4": {kind: 1, offset: 4, typ: NTI13745013, name: "tetO", len: 0, sons: null}, 
"5": {kind: 1, offset: 5, typ: NTI13745013, name: "tetS", len: 0, sons: null}, 
"6": {kind: 1, offset: 6, typ: NTI13745013, name: "tetZ", len: 0, sons: null}, 
"7": {kind: 1, offset: 7, typ: NTI13745013, name: "tetT", len: 0, sons: null}}};
NTI13745013.node = NNI13745013;
var NNI2462651 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI2462651.node = NNI2462651;
var NNI2462619 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI2462619.node = NNI2462619;
NTI2462723.base = NTI2462617;
NTI2462728.base = NTI2462617;
var NNI2462617 = {kind: 2, len: 5, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "parent", len: 0, typ: NTI2462723, name: "parent", sons: null}, 
{kind: 1, offset: "name", len: 0, typ: NTI2456015, name: "name", sons: null}, 
{kind: 1, offset: "message", len: 0, typ: NTI2456013, name: "msg", sons: null}, 
{kind: 1, offset: "trace", len: 0, typ: NTI2456013, name: "trace", sons: null}, 
{kind: 1, offset: "up", len: 0, typ: NTI2462728, name: "up", sons: null}]};
NTI2462617.node = NNI2462617;
var NNI2462408 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI2462408.node = NNI2462408;
NTI2462617.base = NTI2462408;
NTI2462619.base = NTI2462617;
NTI2462651.base = NTI2462619;
var NNI2462641 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI2462641.node = NNI2462641;
NTI2462641.base = NTI2462619;
var NNI12566202 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "a0", len: 0, typ: NTI12566015, name: "a0", sons: null}, 
{kind: 1, offset: "a1", len: 0, typ: NTI12566015, name: "a1", sons: null}]};
NTI12566202.node = NNI12566202;
var NNI13815224 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "a", len: 0, typ: NTI13745013, name: "a", sons: null}, 
{kind: 1, offset: "b", len: 0, typ: NTI13745013, name: "b", sons: null}]};
NTI13815224.node = NNI13815224;
NTI13785378.base = NTI13785382;
NTI13785375.base = NTI13785391;
var NNI13785377 = {kind: 2, len: 3, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "kind", len: 0, typ: NTI13745013, name: "kind", sons: null}, 
{kind: 1, offset: "pos", len: 0, typ: NTI13785378, name: "pos", sons: null}, 
{kind: 1, offset: "rot", len: 0, typ: NTI13785375, name: "rot", sons: null}]};
NTI13785377.node = NNI13785377;
var NNI13787232 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI2456044, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI2456044, name: "Field1", sons: null}]};
NTI13787232.node = NNI13787232;
var NNI13787257 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI2456044, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI2456044, name: "Field1", sons: null}]};
NTI13787257.node = NNI13787257;
var NNI2462653 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI2462653.node = NNI2462653;
NTI2462653.base = NTI2462619;
var NNI7110011 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "a", len: 0, typ: NTI6855232, name: "a", sons: null}, 
{kind: 1, offset: "b", len: 0, typ: NTI2456044, name: "b", sons: null}]};
NTI7110011.node = NNI7110011;
NTI13860428.base = NTI13785377;
var NNI13745002 = {kind: 2, offset: 0, typ: null, name: null, len: 4, sons: {"0": {kind: 1, offset: 0, typ: NTI13745002, name: "gsNone", len: 0, sons: null}, 
"1": {kind: 1, offset: 1, typ: NTI13745002, name: "gsInitial", len: 0, sons: null}, 
"2": {kind: 1, offset: 2, typ: NTI13745002, name: "gsTetris", len: 0, sons: null}, 
"3": {kind: 1, offset: 3, typ: NTI13745002, name: "gsDone", len: 0, sons: null}}};
NTI13745002.node = NNI13745002;
var NNI12522033 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI12522033.node = NNI12522033;
NTI12522018.base = NTI12522033;
var NNI13745008 = {kind: 1, offset: "background", len: 0, typ: NTI12522018, name: "background", sons: null};
NTI13745008.node = NNI13745008;
NTI13825207.base = NTI13745013;
NTI13825211.base = NTI13785377;
var NNI13825202 = {kind: 2, len: 10, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "board", len: 0, typ: NTI13825207, name: "board", sons: null}, 
{kind: 1, offset: "nextPieces", len: 0, typ: NTI13825211, name: "nextPieces", sons: null}, 
{kind: 1, offset: "piece", len: 0, typ: NTI13785377, name: "piece", sons: null}, 
{kind: 1, offset: "pieceDropTicking", len: 0, typ: NTI2456064, name: "pieceDropTicking", sons: null}, 
{kind: 1, offset: "pieceDropTick", len: 0, typ: NTI2456066, name: "pieceDropTick", sons: null}, 
{kind: 1, offset: "pieceDropTime", len: 0, typ: NTI13825216, name: "pieceDropTime", sons: null}, 
{kind: 1, offset: "pieceDropRetry", len: 0, typ: NTI2456066, name: "pieceDropRetry", sons: null}, 
{kind: 1, offset: "pieceDropRetries", len: 0, typ: NTI2456068, name: "pieceDropRetries", sons: null}, 
{kind: 1, offset: "holdPiece", len: 0, typ: NTI13785377, name: "holdPiece", sons: null}, 
{kind: 1, offset: "justHeld", len: 0, typ: NTI2456064, name: "justHeld", sons: null}]};
NTI13825202.node = NNI13825202;
var NNI14020063 = {kind: 3, offset: "kind", len: 4, typ: NTI13745002, name: "kind", sons: [[setConstr(1), {kind: 1, offset: "initial", len: 0, typ: NTI13745008, name: "initial", sons: null}], 
[setConstr(2), {kind: 1, offset: "tetris", len: 0, typ: NTI13825202, name: "tetris", sons: null}], 
[setConstr(3), {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []}], 
[setConstr(4), {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []}]]};
NTI14020063.node = NNI14020063;
NTI13785371.base = NTI13785385;
var NNI13805029 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "a", len: 0, typ: NTI13785371, name: "a", sons: null}, 
{kind: 1, offset: "b", len: 0, typ: NTI13785371, name: "b", sons: null}]};
NTI13805029.node = NNI13805029;
NTI13785373.base = NTI13785388;
var NNI13810029 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "a", len: 0, typ: NTI13785373, name: "a", sons: null}, 
{kind: 1, offset: "b", len: 0, typ: NTI13785373, name: "b", sons: null}]};
NTI13810029.node = NNI13810029;
var NNI14505002 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI2456005, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI2456005, name: "Field1", sons: null}]};
NTI14505002.node = NNI14505002;
function arrayConstr(len_2750067, value_2750068, typ_2750069) {
        var result = new Array(len_2750067);
    for (var i = 0; i < len_2750067; ++i) result[i] = nimCopy(null, value_2750068, typ_2750069);
    return result;
  

  
}
function setConstr() {
        var result = {};
    for (var i = 0; i < arguments.length; ++i) {
      var x = arguments[i];
      if (typeof(x) == "object") {
        for (var j = x[0]; j <= x[1]; ++j) {
          result[j] = true;
        }
      } else {
        result[x] = true;
      }
    }
    return result;
  

  
}
var ConstSet1 = setConstr(17, 16, 4, 18, 27, 19, 23, 22, 21);
function nimCopy(dest_2740023, src_2740024, ti_2740025) {
  var result_2745219 = null;

    switch (ti_2740025.kind) {
    case 21:
    case 22:
    case 23:
    case 5:
      if (!(isFatPointer_2735401(ti_2740025))) {
      result_2745219 = src_2740024;
      }
      else {
        result_2745219 = [src_2740024[0], src_2740024[1]];
      }
      
      break;
    case 19:
            if (dest_2740023 === null || dest_2740023 === undefined) {
        dest_2740023 = {};
      }
      else {
        for (var key in dest_2740023) { delete dest_2740023[key]; }
      }
      for (var key in src_2740024) { dest_2740023[key] = src_2740024[key]; }
      result_2745219 = dest_2740023;
    
      break;
    case 18:
    case 17:
      if (!((ti_2740025.base == null))) {
      result_2745219 = nimCopy(dest_2740023, src_2740024, ti_2740025.base);
      }
      else {
      if ((ti_2740025.kind == 17)) {
      result_2745219 = (dest_2740023 === null || dest_2740023 === undefined) ? {m_type: ti_2740025} : dest_2740023;
      }
      else {
        result_2745219 = (dest_2740023 === null || dest_2740023 === undefined) ? {} : dest_2740023;
      }
      }
      nimCopyAux(result_2745219, src_2740024, ti_2740025.node);
      break;
    case 24:
    case 4:
    case 27:
    case 16:
            if (src_2740024 === null) {
        result_2745219 = null;
      }
      else {
        if (dest_2740023 === null || dest_2740023 === undefined) {
          dest_2740023 = new Array(src_2740024.length);
        }
        else {
          dest_2740023.length = src_2740024.length;
        }
        result_2745219 = dest_2740023;
        for (var i = 0; i < src_2740024.length; ++i) {
          result_2745219[i] = nimCopy(result_2745219[i], src_2740024[i], ti_2740025.base);
        }
      }
    
      break;
    case 28:
            if (src_2740024 !== null) {
        result_2745219 = src_2740024.slice(0);
      }
    
      break;
    default: 
      result_2745219 = src_2740024;
      break;
    }

  return result_2745219;

}
var ConstSet2 = setConstr(1);
function makeNimstrLit(c_2725062) {
      var ln = c_2725062.length;
  var result = new Array(ln);
  for (var i = 0; i < ln; ++i) {
    result[i] = c_2725062.charCodeAt(i);
  }
  return result;
  

  
}
function toJSStr(s_2725096) {
                    var Tmp5;
            var Tmp7;

  var result_2725097 = null;

    var res_2725170 = newSeq_2725128((s_2725096).length);
    var i_2725172 = 0;
    var j_2725174 = 0;
    L1: do {
        L2: while (true) {
        if (!(i_2725172 < (s_2725096).length)) break L2;
          var c_2725175 = s_2725096[i_2725172];
          if ((c_2725175 < 128)) {
          res_2725170[j_2725174] = String.fromCharCode(c_2725175);
          i_2725172 += 1;
          }
          else {
            var helper_2725198 = newSeq_2725128(0);
            L3: do {
                L4: while (true) {
                if (!true) break L4;
                  var code_2725199 = c_2725175.toString(16);
                  if (((code_2725199).length == 1)) {
                  helper_2725198.push("%0");;
                  }
                  else {
                  helper_2725198.push("%");;
                  }
                  
                  helper_2725198.push(code_2725199);;
                  i_2725172 += 1;
                    if (((s_2725096).length <= i_2725172)) Tmp5 = true; else {                      Tmp5 = (s_2725096[i_2725172] < 128);                    }                  if (Tmp5) {
                  break L3;
                  }
                  
                  c_2725175 = s_2725096[i_2725172];
                }
            } while(false);
++excHandler;
            Tmp7 = framePtr;
            try {
            res_2725170[j_2725174] = decodeURIComponent(helper_2725198.join(""));
--excHandler;
} catch (EXC) {
 var prevJSError = lastJSError;
 lastJSError = EXC;
 --excHandler;
            framePtr = Tmp7;
            res_2725170[j_2725174] = helper_2725198.join("");
            lastJSError = prevJSError;
            } finally {
            framePtr = Tmp7;
            }
          }
          
          j_2725174 += 1;
        }
    } while(false);
    if (res_2725170.length < j_2725174) { for (var i=res_2725170.length;i<j_2725174;++i) res_2725170.push(null); }
               else { res_2725170.length = j_2725174; };
    result_2725097 = res_2725170.join("");

  return result_2725097;

}
function raiseException(e_2690218, ename_2690219) {
    e_2690218.name = ename_2690219;
    if ((excHandler == 0)) {
    unhandledException(e_2690218);
    }
    
    throw e_2690218;

  
}
function raiseFieldError(f_2720047) {
    raiseException({message: nimCopy(null, f_2720047, NTI2456013), parent: null, m_type: NTI2462651, name: null, trace: [], up: null}, "FieldDefect");

  
}
var ConstSet3 = setConstr(2);
var ConstSet4 = setConstr(2);
var ConstSet5 = setConstr(2);
var ConstSet6 = setConstr(2);
var ConstSet7 = setConstr(2);
var ConstSet8 = setConstr(2);
var ConstSet9 = setConstr(2);
    var minDims_13815213 = [{Field0: 0, Field1: 0}, {Field0: 0, Field1: 0}, {Field0: 0, Field1: -1}, {Field0: -1, Field1: -1}, {Field0: 0, Field1: 0}, {Field0: -1, Field1: 0}, {Field0: -1, Field1: 0}, {Field0: -1, Field1: 0}];
var ConstSet10 = setConstr(2);
var ConstSet11 = setConstr(2, 3);
        var pieceExtensions_13785367 = [[], [{Field0: 0, Field1: 1}, {Field0: 0, Field1: 2}, {Field0: 0, Field1: 3}], [{Field0: 0, Field1: -1}, {Field0: 1, Field1: -1}, {Field0: 0, Field1: 1}], [{Field0: -1, Field1: -1}, {Field0: 0, Field1: -1}, {Field0: 0, Field1: 1}], [{Field0: 0, Field1: 1}, {Field0: 1, Field1: 0}, {Field0: 1, Field1: 1}], [{Field0: -1, Field1: 1}, {Field0: 0, Field1: 1}, {Field0: 1, Field1: 0}], [{Field0: -1, Field1: 0}, {Field0: 0, Field1: 1}, {Field0: 1, Field1: 1}], [{Field0: -1, Field1: 0}, {Field0: 0, Field1: 1}, {Field0: 1, Field1: 0}]];
function cstrToNimstr(c_2725079) {
      var ln = c_2725079.length;
  var result = new Array(ln);
  var r = 0;
  for (var i = 0; i < ln; ++i) {
    var ch = c_2725079.charCodeAt(i);

    if (ch < 128) {
      result[r] = ch;
    }
    else {
      if (ch < 2048) {
        result[r] = (ch >> 6) | 192;
      }
      else {
        if (ch < 55296 || ch >= 57344) {
          result[r] = (ch >> 12) | 224;
        }
        else {
            ++i;
            ch = 65536 + (((ch & 1023) << 10) | (c_2725079.charCodeAt(i) & 1023));
            result[r] = (ch >> 18) | 240;
            ++r;
            result[r] = ((ch >> 12) & 63) | 128;
        }
        ++r;
        result[r] = ((ch >> 6) & 63) | 128;
      }
      ++r;
      result[r] = (ch & 63) | 128;
    }
    ++r;
  }
  return result;
  

  
}
var ConstSet12 = setConstr(2);
var ConstSet13 = setConstr(2);
var ConstSet14 = setConstr(2);
var ConstSet15 = setConstr(2);
var ConstSet16 = setConstr(2);
var ConstSet17 = setConstr(2);
var ConstSet18 = setConstr(2);
var ConstSet19 = setConstr(2);
var ConstSet20 = setConstr(2);
var ConstSet21 = setConstr(2);
var ConstSet22 = setConstr(2);
var ConstSet23 = setConstr(2);
var ConstSet24 = setConstr(2);
var ConstSet25 = setConstr(2);
var ConstSet26 = setConstr(2);
var ConstSet27 = setConstr(2);
var ConstSet28 = setConstr(2);
var ConstSet29 = setConstr(2);
var ConstSet30 = setConstr(2);
var ConstSet31 = setConstr(2);
var ConstSet32 = setConstr(2);
var ConstSet33 = setConstr(2);
function nimMax(a_2730821, b_2730822) {
    var Tmp1;

  var result_2730823 = 0;

  BeforeRet: do {
    if ((b_2730822 <= a_2730821)) {
    Tmp1 = a_2730821;
    }
    else {
    Tmp1 = b_2730822;
    }
    
    result_2730823 = Tmp1;
    break BeforeRet;
  } while (false);

  return result_2730823;

}
function nimMin(a_2730803, b_2730804) {
    var Tmp1;

  var result_2730805 = 0;

  BeforeRet: do {
    if ((a_2730803 <= b_2730804)) {
    Tmp1 = a_2730803;
    }
    else {
    Tmp1 = b_2730804;
    }
    
    result_2730805 = Tmp1;
    break BeforeRet;
  } while (false);

  return result_2730805;

}
var ConstSet34 = setConstr(2);
var ConstSet35 = setConstr(2);
var ConstSet36 = setConstr(2);
var ConstSet37 = setConstr(2);
var ConstSet38 = setConstr(2);
var ConstSet39 = setConstr(2);
var ConstSet40 = setConstr(2);
var ConstSet41 = setConstr(2);
var ConstSet42 = setConstr(2);
var ConstSet43 = setConstr(2);
var ConstSet44 = setConstr(2);
var ConstSet45 = setConstr(2);
var ConstSet46 = setConstr(2);
var ConstSet47 = setConstr(2);
var ConstSet48 = setConstr(2);
var ConstSet49 = setConstr(2);
var ConstSet50 = setConstr(2);
var ConstSet51 = setConstr(2);
var ConstSet52 = setConstr(2);
var ConstSet53 = setConstr(2);
var ConstSet54 = setConstr(2);
var ConstSet55 = setConstr(1);
var ConstSet56 = setConstr(2);
              var pieceColors_13785202 = ["rgba(0,0,0,0.0)", "rgba(0,127,255,1.0)", "rgba(0,0,255,1.0)", "rgba(255,127,0,1.0)", "rgba(255,255,0,1.0)", "rgba(0,255,127,1.0)", "rgba(255,0,0,1.0)", "rgba(255,0,255,1.0)"];
var ConstSet57 = setConstr(2);
var ConstSet58 = setConstr(2);
var ConstSet59 = setConstr(2);
var ConstSet60 = setConstr(2);
var ConstSet61 = setConstr(2);
var ConstSet62 = setConstr(2);
var ConstSet63 = setConstr(2);
var ConstSet64 = setConstr(2);
var ConstSet65 = setConstr(2);
var ConstSet66 = setConstr(2);
var ConstSet67 = setConstr(2);
var ConstSet68 = setConstr(2);
var ConstSet69 = setConstr(2);
if (!Math.trunc) {
  Math.trunc = function(v) {
    v = +v;
    if (!isFinite(v)) return v;
    return (v - v % 1) || (v < 0 ? -0 : v === 0 ? v : 0);
  };
}

var objectID_11670031 = [0];
var canvas_12550008 = document.getElementById("fup1");
var context_12550009 = canvas_12550008.getContext('2d');
var currentMusic_12550201 = [null];
var musicVolume_12550203 = [128];
var numTicks_12550204 = [0];
var fps_12550205 = [0];
var state_12566205 = [{a0: 1773455756, a1: 4275166512}];
if (globalThis.utcInstance_13160231 === undefined) {
  utcInstance_13160231 = [null];
}
if (globalThis.localInstance_13160232 === undefined) {
  localInstance_13160232 = [null];
}
function isFatPointer_2735401(ti_2735403) {
  var result_2735404 = false;

  BeforeRet: do {
    result_2735404 = !((ConstSet1[ti_2735403.base.kind] != undefined));
    break BeforeRet;
  } while (false);

  return result_2735404;

}
function nimCopyAux(dest_2740028, src_2740029, n_2740031) {
    switch (n_2740031.kind) {
    case 0:
      break;
    case 1:
            dest_2740028[n_2740031.offset] = nimCopy(dest_2740028[n_2740031.offset], src_2740029[n_2740031.offset], n_2740031.typ);
    
      break;
    case 2:
          for (var i = 0; i < n_2740031.sons.length; i++) {
      nimCopyAux(dest_2740028, src_2740029, n_2740031.sons[i]);
    }
    
      break;
    case 3:
            dest_2740028[n_2740031.offset] = nimCopy(dest_2740028[n_2740031.offset], src_2740029[n_2740031.offset], n_2740031.typ);
      for (var i = 0; i < n_2740031.sons.length; ++i) {
        nimCopyAux(dest_2740028, src_2740029, n_2740031.sons[i][1]);
      }
    
      break;
    }

  
}
function add_2627211(x_2627214, x_2627214_Idx, y_2627215) {
          if (x_2627214[x_2627214_Idx] === null) { x_2627214[x_2627214_Idx] = []; }
      var off = x_2627214[x_2627214_Idx].length;
      x_2627214[x_2627214_Idx].length += y_2627215.length;
      for (var i = 0; i < y_2627215.length; ++i) {
        x_2627214[x_2627214_Idx][off+i] = y_2627215.charCodeAt(i);
      }
    

  
}
function newSeq_2725128(len_2725131) {
  var result_2725133 = [];

    result_2725133 = new Array(len_2725131); for (var i=0;i<len_2725131;++i) {result_2725133[i]=null;}
  return result_2725133;

}
function unhandledException(e_2685059) {
    var buf_2685060 = [[]];
    if (!(((e_2685059.message).length == 0))) {
    buf_2685060[0].push.apply(buf_2685060[0], makeNimstrLit("Error: unhandled exception: "));;
    buf_2685060[0].push.apply(buf_2685060[0], e_2685059.message);;
    }
    else {
    buf_2685060[0].push.apply(buf_2685060[0], makeNimstrLit("Error: unhandled exception"));;
    }
    
    buf_2685060[0].push.apply(buf_2685060[0], makeNimstrLit(" ["));;
    add_2627211(buf_2685060, 0, e_2685059.name);
    buf_2685060[0].push.apply(buf_2685060[0], makeNimstrLit("]\x0A"));;
    var cbuf_2690201 = toJSStr(buf_2685060[0]);
    framePtr = null;
      if (typeof(Error) !== "undefined") {
    throw new Error(cbuf_2690201);
  }
  else {
    throw cbuf_2690201;
  }
  

  
}
function loadTexture_12522061(url_12522063) {
  var result_12522064 = null;

      result_12522064 = new Image();
  result_12522064.src = url_12522063;
  

  return result_12522064;

}
function toFloat_2486659(i_2486661) {
  var result_2486662 = 0.0;

    result_2486662 = i_2486661;

  return result_2486662;

}
function HEX2F_2825648(x_2825650, y_2825651) {
  var result_2825652 = 0.0;

    result_2825652 = (toFloat_2486659(x_2825650) / toFloat_2486659(y_2825651));

  return result_2825652;

}
function epochTime_13730141() {
  var result_13730143 = 0.0;

    result_13730143 = HEX2F_2825648(new Date().getTime(), 1000);

  return result_13730143;

}
function sysFatal_2575418(message_2575422) {
    raiseException({message: nimCopy(null, message_2575422, NTI2456013), m_type: NTI2462641, parent: null, name: null, trace: [], up: null}, "AssertionDefect");

  
}
function raiseAssert_2575414(msg_2575416) {
    sysFatal_2575418(msg_2575416);

  
}
function failedAssertImpl_2575480(msg_2575482) {
    raiseAssert_2575414(msg_2575482);

  
}
function rotl_12566430(x_12566432, k_12566433) {
  var result_12566434 = 0;

    result_12566434 = ((x_12566432 << k_12566433) | ((x_12566432 >>> 0) >>> ((64 - k_12566433) >>> 0)));

  return result_12566434;

}
function next_12566458(r_12566461) {
  var result_12566462 = 0;

    var s0_12566463 = r_12566461.a0;
    var s1_12566464 = r_12566461.a1;
    result_12566462 = ((s0_12566463 + s1_12566464) >>> 0);
    s1_12566464 = (s1_12566464 ^ s0_12566463);
    r_12566461.a0 = ((rotl_12566430(s0_12566463, 55) ^ s1_12566464) ^ (s1_12566464 << 14));
    r_12566461.a1 = rotl_12566430(s1_12566464, 36);

  return result_12566462;

}
function initRand_12590214(seed_12590216) {
  var result_12590217 = [({a0: 0, a1: 0})];

    if (!(!((seed_12590216 == 0)))) {
    failedAssertImpl_2575480(makeNimstrLit("random.nim(568, 12) `seed != 0` "));
    }
    
    result_12590217[0].a0 = Math.floor(seed_12590216 / Math.pow(2,16));
    result_12590217[0].a1 = (seed_12590216 & 65535);
    var _ = next_12566458(result_12590217[0]);

  return result_12590217[0];

}
function randomize_12605222(seed_12605224) {
    nimCopy(state_12566205[0], initRand_12590214(seed_12605224), NTI12566202);

  
}
function randomize_13731001() {
    var time_13731203 = ((epochTime_13730141() * 1.0000000000000000e+003) & 2147483647);
    randomize_12605222(time_13731203);

  
}
function rand_12570049(r_12570052, max_12570053) {
  var result_12570054 = 0;

  BeforeRet: do {
    if ((max_12570053 == 0)) {
    break BeforeRet;
    }
    
    L1: do {
        L2: while (true) {
        if (!true) break L2;
          var x_12570055 = next_12566458(r_12570052);
          if ((x_12570055 <= ((4294967295 - (4294967295 % (max_12570053 >>> 0))) >>> 0))) {
          result_12570054 = (x_12570055 % ((max_12570053 + 1) ));
          break BeforeRet;
          }
          
        }
    } while(false);
  } while (false);

  return result_12570054;

}
function rand_13815307(r_13815310, x_13815312) {
  var result_13815313 = 0;

    result_13815313 = (rand_12570049(r_13815310, (((x_13815312.b)|0) - ((x_13815312.a)|0))) + ((x_13815312.a)|0));

  return result_13815313;

}
function rand_13815282(x_13815286) {
  var result_13815287 = 0;

    result_13815287 = rand_13815307(state_12566205[0], x_13815286);

  return result_13815287;

}
function HEX2EHEX2E_13815214(a_13815219, b_13815221) {
  var result_13815227 = ({a: 0, b: 0});

    nimCopy(result_13815227, {a: a_13815219, b: b_13815221}, NTI13815224);

  return result_13815227;

}
function coord_13785422(x_13785424, y_13785425) {
  var result_13785426 = 0;

    result_13785426 = ((y_13785425 * 10) + x_13785424);

  return result_13785426;

}
function randomNextPiece_13815032() {
  var result_13815034 = ({kind: 0, pos: 0, rot: 0});

    result_13815034.kind = rand_13815282(HEX2EHEX2E_13815214(1, 7));
    result_13815034.pos = coord_13785422(-(minDims_13815213[result_13815034.kind]["Field0"]), -(minDims_13815213[result_13815034.kind]["Field1"]));

  return result_13815034;

}
function rot_13787227(x_13787229, y_13787230, q_13787231) {
    var Tmp1;

  var result_13787233 = {Field0: 0, Field1: 0};

    switch (q_13787231) {
    case 0:
      Tmp1 = {Field0: x_13787229, Field1: y_13787230};
      break;
    case 1:
      Tmp1 = {Field0: y_13787230, Field1: -(x_13787229)};
      break;
    case 2:
      Tmp1 = {Field0: -(x_13787229), Field1: -(y_13787230)};
      break;
    case 3:
      Tmp1 = {Field0: -(y_13787230), Field1: x_13787229};
      break;
    }
    nimCopy(result_13787233, Tmp1, NTI13787232);

  return result_13787233;

}
function column_13785500(c_13785502) {
  var result_13785503 = 0;

    result_13785503 = Math.trunc(c_13785502 % 10);

  return result_13785503;

}
function row_13785517(c_13785519) {
  var result_13785520 = 0;

    result_13785520 = Math.trunc(c_13785519 / 10);

  return result_13785520;

}
function plusRot_13787251(a_13787253, x_13787254, y_13787255, q_13787256) {
  var result_13787258 = {Field0: 0, Field1: 0};

    var colontmp__14391286 = rot_13787227(x_13787254, y_13787255, q_13787256);
    var rotx_13787259 = colontmp__14391286["Field0"];
    var roty_13787260 = colontmp__14391286["Field1"];
    var colontmp__14391284 = (column_13785500(a_13787253) + rotx_13787259);
    var colontmp__14391285 = (row_13785517(a_13787253) + roty_13787260);
    nimCopy(result_13787258, {Field0: colontmp__14391284, Field1: colontmp__14391285}, NTI13787257);

  return result_13787258;

}
function overlaps_13815456(board_13815461, piece_13815462) {
  var result_13815463 = false;

  BeforeRet: do {
    result_13815463 = false;
    L1: do {
      var c_13815464 = 0;
      if (!((piece_13815462.kind == 0))) {
      c_13815464 = piece_13815462.pos;
      if (!((board_13815461[c_13815464] == 0))) {
      result_13815463 = true;
      break BeforeRet;
      }
      
      }
      
      L2: do {
        var x_14391275 = null;
        var x_14391275_Idx = 0;
        var y_14391276 = null;
        var y_14391276_Idx = 0;
        var colontmp__14391277 = [];
        colontmp__14391277 = pieceExtensions_13785367[piece_13815462.kind];
        var i_14391278 = 0;
        var L_14391279 = (colontmp__14391277).length;
        L3: do {
            L4: while (true) {
            if (!(i_14391278 < L_14391279)) break L4;
              x_14391275 = colontmp__14391277[i_14391278]; x_14391275_Idx = "Field0";
              y_14391276 = colontmp__14391277[i_14391278]; y_14391276_Idx = "Field1";
              var colontmp__14391283 = plusRot_13787251(piece_13815462.pos, x_14391275[x_14391275_Idx], y_14391276[y_14391276_Idx], piece_13815462.rot);
              var c_14391281 = colontmp__14391283["Field0"];
              var r_14391282 = colontmp__14391283["Field1"];
              c_13815464 = coord_13785422(c_14391281, r_14391282);
              if (!((board_13815461[c_13815464] == 0))) {
              result_13815463 = true;
              break BeforeRet;
              }
              
              i_14391278 += 1;
            }
        } while(false);
      } while(false);
    } while(false);
  } while (false);

  return result_13815463;

}
function spawnPiece_13870084(state_13870086, initial_13870087) {
    var Tmp1;

    nimCopy(state_13870086.piece, initial_13870087, NTI13785377);
    if ((state_13870086.piece.kind == 0)) {
    state_13870086.piece.kind = rand_13815282(HEX2EHEX2E_13815214(1, 7));
    }
    
    if ((ConstSet11[state_13870086.piece.kind] != undefined)) {
    Tmp1 = 11;
    }
    else {
    Tmp1 = 10;
    }
    
    state_13870086.piece.pos = coord_13785422(5, Tmp1);
    L2: do {
        L3: while (true) {
        if (!overlaps_13815456(state_13870086.board, state_13870086.piece)) break L3;
          state_13870086.piece.pos = (state_13870086.piece.pos - 10);
        }
    } while(false);
    state_13870086.pieceDropTick = 0;

  
}
function sysFatal_13860837(message_13860841) {
    raiseException({message: nimCopy(null, message_13860841, NTI2456013), m_type: NTI2462653, parent: null, name: null, trace: [], up: null}, "RangeDefect");

  
}
function HEX5BHEX5DHEX3D_13860508(a_13860516, x_13860518, b_13860520) {
    var xa_13860601 = x_13860518.a;
    var L_13860822 = (((4 - x_13860518.b) - xa_13860601) + 1);
    if ((L_13860822 == (b_13860520).length)) {
    L1: do {
      var i_13860834 = 0;
      var i_14391295 = 0;
      L2: do {
          L3: while (true) {
          if (!(i_14391295 < L_13860822)) break L3;
            i_13860834 = i_14391295;
            nimCopy(a_13860516[(i_13860834 + xa_13860601)], b_13860520[i_13860834], NTI13785377);
            i_14391295 += 1;
          }
      } while(false);
    } while(false);
    }
    else {
    sysFatal_13860837(makeNimstrLit("different lengths for slice assignment"));
    }
    

  
}
function HEX2EHEX2E_7110001(a_7110006, b_7110008) {
  var result_7110014 = ({a: 0, b: 0});

    nimCopy(result_7110014, {a: a_7110006, b: b_7110008}, NTI7110011);

  return result_7110014;

}
function newSeq_13860424(len_13860427) {
  var result_13860429 = [];

    result_13860429 = new Array(len_13860427); for (var i=0;i<len_13860427;++i) {result_13860429[i]=({kind: 0, pos: 0, rot: 0});}
  return result_13860429;

}
function HEX5BHEX5D_13860029(a_13860036, x_13860038) {
  var result_13860040 = [];

    var xa_13860201 = x_13860038.a;
    var L_13860422 = (((4 - x_13860038.b) - xa_13860201) + 1);
    result_13860040 = nimCopy(null, newSeq_13860424(L_13860422), NTI13860428);
    L1: do {
      var i_13860472 = 0;
      var i_14391303 = 0;
      L2: do {
          L3: while (true) {
          if (!(i_14391303 < L_13860422)) break L3;
            i_13860472 = i_14391303;
            nimCopy(result_13860040[i_13860472], a_13860036[(i_13860472 + xa_13860201)], NTI13785377);
            i_14391303 += 1;
          }
      } while(false);
    } while(false);

  return result_13860040;

}
function HEX5BHEX5DHEX3D_13870003(a_13870009, i_13870010, x_13870011) {
    nimCopy(a_13870009[((4 - i_13870010) + 0)], x_13870011, NTI13785377);

  
}
function nextPiece_13825222(state_13825224) {
  var result_13825225 = ({kind: 0, pos: 0, rot: 0});

    nimCopy(result_13825225, state_13825224.nextPieces[0], NTI13785377);
    HEX5BHEX5DHEX3D_13860508(state_13825224.nextPieces, HEX2EHEX2E_7110001(0, 2), HEX5BHEX5D_13860029(state_13825224.nextPieces, HEX2EHEX2E_7110001(1, 1)));
    HEX5BHEX5DHEX3D_13870003(state_13825224.nextPieces, 1, randomNextPiece_13815032());

  return result_13825225;

}
function setMusic_12522091(music_12522094, music_12522094_Idx, file_12522095) {
    if (!((music_12522094[music_12522094_Idx] == null))) {
    music_12522094[music_12522094_Idx].pause();
    music_12522094[music_12522094_Idx] = null;
    }
    
    music_12522094[music_12522094_Idx] = new Audio(file_12522095);

  
}
function init_14020069(state_14020071) {
      var Tmp1;
      var Tmp2;
      var Tmp3;
      var Tmp4;
      var Tmp5;
      var Tmp6;
      var Tmp7;
              var Tmp11;
              var Tmp12;
      var Tmp13;

    switch (state_14020071.kind) {
    case 1:
      var Tmp1 = state_14020071;
      if (ConstSet2[Tmp1.kind]===undefined) { raiseFieldError(makeNimstrLit("\'initial\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp1.initial.background = loadTexture_12522061("assets/mainmenu.png");
      break;
    case 2:
      var Tmp2 = state_14020071;
      if (ConstSet3[Tmp2.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp2.tetris.pieceDropTicking = true;
      var Tmp3 = state_14020071;
      if (ConstSet4[Tmp3.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp3.tetris.pieceDropTick = 0;
      var Tmp4 = state_14020071;
      if (ConstSet5[Tmp4.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp4.tetris.pieceDropTime = 120;
      var Tmp5 = state_14020071;
      if (ConstSet6[Tmp5.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp5.tetris.pieceDropRetry = 0;
      var Tmp6 = state_14020071;
      if (ConstSet7[Tmp6.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp6.tetris.pieceDropRetries = 1;
      var Tmp7 = state_14020071;
      if (ConstSet8[Tmp7.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp7.tetris.justHeld = false;
      randomize_13731001();
      L8: do {
        var np_14025052 = null;
        var i_14391250 = 0;
        if ((i_14391250 <= 3)) {
        L9: do {
            L10: while (true) {
            if (!true) break L10;
              var Tmp11 = state_14020071;
              if (ConstSet9[Tmp11.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
              np_14025052 = (Tmp12 = Tmp11.tetris.nextPieces, Tmp12)[i_14391250];
              nimCopy(np_14025052, randomNextPiece_13815032(), NTI13785377);
              if ((3 <= i_14391250)) {
              break L9;
              }
              
              i_14391250 += 1;
            }
        } while(false);
        }
        
      } while(false);
      var Tmp13 = state_14020071;
      if (ConstSet10[Tmp13.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      var HEX3Atmp_14025055 = Tmp13.tetris;
      spawnPiece_13870084(HEX3Atmp_14025055, nextPiece_13825222(HEX3Atmp_14025055));
      setMusic_12522091(currentMusic_12550201, 0, "assets/music.ogg");
      var mHEX60gensym180_14030001 = currentMusic_12550201[0];
      mHEX60gensym180_14030001.loop = true;
      mHEX60gensym180_14030001.play();
      break;
    case 3:
      break;
    default: 
      break;
    }

  
}
var game_14245401 = [{kind: 1, initial: ({background: null}), tetris: ({board: arrayConstr(300, 0, NTI13745013), nextPieces: [({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0})], piece: ({kind: 0, pos: 0, rot: 0}), pieceDropTicking: false, pieceDropTick: 0, pieceDropTime: 0, pieceDropRetry: 0, pieceDropRetries: 0, holdPiece: ({kind: 0, pos: 0, rot: 0}), justHeld: false})}];
init_14020069(game_14245401[0]);
window.requestAnimationFrame =
  window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    ((cb) => window.setTimeout(callback, 1000 / 60));

function finish_14030066(state_14030068) {
    switch (state_14030068.kind) {
    case 1:
      break;
    case 2:
      currentMusic_12550201[0].pause();
      currentMusic_12550201[0] = null;
      break;
    case 3:
      break;
    default: 
      break;
    }

  
}
function contains_13805075(s_13805081, value_13805082) {
    var Tmp1;

  var result_13805083 = false;

    if (!(s_13805081.a <= value_13805082)) Tmp1 = false; else {      Tmp1 = (value_13805082 <= s_13805081.b);    }    result_13805083 = Tmp1;

  return result_13805083;

}
function HEX2EHEX2E_13805019(a_13805024, b_13805026) {
  var result_13805032 = ({a: 0, b: 0});

    nimCopy(result_13805032, {a: nimCopy(null, a_13805024, NTI13785371), b: nimCopy(null, b_13805026, NTI13785371)}, NTI13805029);

  return result_13805032;

}
function contains_13805002(x_13805007) {
  var result_13805008 = false;

    result_13805008 = contains_13805075(HEX2EHEX2E_13805019(0, 9), x_13805007);

  return result_13805008;

}
function contains_13810075(s_13810081, value_13810082) {
    var Tmp1;

  var result_13810083 = false;

    if (!(s_13810081.a <= value_13810082)) Tmp1 = false; else {      Tmp1 = (value_13810082 <= s_13810081.b);    }    result_13810083 = Tmp1;

  return result_13810083;

}
function HEX2EHEX2E_13810019(a_13810024, b_13810026) {
  var result_13810032 = ({a: 0, b: 0});

    nimCopy(result_13810032, {a: nimCopy(null, a_13810024, NTI13785373), b: nimCopy(null, b_13810026, NTI13785373)}, NTI13810029);

  return result_13810032;

}
function contains_13810002(x_13810007) {
  var result_13810008 = false;

    result_13810008 = contains_13810075(HEX2EHEX2E_13810019(0, 29), x_13810007);

  return result_13810008;

}
function rotate_13925014(state_13925016, forward_13925017) {
    var Tmp1;
    var Tmp2;
      var Tmp3;

  BeforeRet: do {
    var oldRot_13930001 = state_13925016.piece.rot;
    if (forward_13925017) {
    if ((oldRot_13930001 == 3)) {
    Tmp2 = 0;
    }
    else {
    Tmp2 = (oldRot_13930001 + 1);
    }
    
    Tmp1 = Tmp2;
    }
    else {
      if ((oldRot_13930001 == 0)) {
      Tmp3 = 3;
      }
      else {
      Tmp3 = (oldRot_13930001 - 1);
      }
      
    Tmp1 = Tmp3;
    }
    
    var newRot_13930026 = Tmp1;
    var newPiece_13935001 = nimCopy(null, state_13925016.piece, NTI13785377);
    newPiece_13935001.rot = newRot_13930026;
    var outOfBounds_13935002 = [false];
    L4: do {
      var __13935004 = 0;
      if (!((newPiece_13935001.kind == 0))) {
      __13935004 = newPiece_13935001.pos;
      }
      
      L5: do {
        var x_14895844 = null;
        var x_14895844_Idx = 0;
        var y_14895845 = null;
        var y_14895845_Idx = 0;
        var colontmp__14895846 = [];
        colontmp__14895846 = pieceExtensions_13785367[newPiece_13935001.kind];
        var i_14895847 = 0;
        var L_14895848 = (colontmp__14895846).length;
        L6: do {
            L7: while (true) {
            if (!(i_14895847 < L_14895848)) break L7;
              x_14895844 = colontmp__14895846[i_14895847]; x_14895844_Idx = "Field0";
              y_14895845 = colontmp__14895846[i_14895847]; y_14895845_Idx = "Field1";
              var colontmp__14895883 = plusRot_13787251(newPiece_13935001.pos, x_14895844[x_14895844_Idx], y_14895845[y_14895845_Idx], newPiece_13935001.rot);
              var col_14895850 = colontmp__14895883["Field0"];
              var row_14895851 = colontmp__14895883["Field1"];
              if ((contains_13805002(col_14895850) && contains_13810002(row_14895851))) {
              __13935004 = coord_13785422(col_14895850, row_14895851);
              }
              else {
                outOfBounds_13935002[0] = true;
                break L5;
              }
              
              i_14895847 += 1;
            }
        } while(false);
      } while(false);
    } while(false);
    var i_13935006 = 1;
    L8: do {
        L9: while (true) {
        if (!outOfBounds_13935002[0]) break L9;
          outOfBounds_13935002[0] = false;
          var colontmp__14895888 = {Field0: column_13785500(newPiece_13935001.pos), Field1: row_13785517(newPiece_13935001.pos)};
          var col0_13935008 = colontmp__14895888["Field0"];
          var row0_13935009 = colontmp__14895888["Field1"];
          var oneInside_13935010 = false;
          if (contains_13805002((col0_13935008 - i_13935006))) {
          oneInside_13935010 = true;
          newPiece_13935001.pos = coord_13785422((col0_13935008 - i_13935006), row0_13935009);
          L10: do {
            var __13940009 = 0;
            if (!((newPiece_13935001.kind == 0))) {
            __13940009 = newPiece_13935001.pos;
            }
            
            L11: do {
              var x_14895858 = null;
              var x_14895858_Idx = 0;
              var y_14895859 = null;
              var y_14895859_Idx = 0;
              var colontmp__14895860 = [];
              colontmp__14895860 = pieceExtensions_13785367[newPiece_13935001.kind];
              var i_14895861 = 0;
              var L_14895862 = (colontmp__14895860).length;
              L12: do {
                  L13: while (true) {
                  if (!(i_14895861 < L_14895862)) break L13;
                    x_14895858 = colontmp__14895860[i_14895861]; x_14895858_Idx = "Field0";
                    y_14895859 = colontmp__14895860[i_14895861]; y_14895859_Idx = "Field1";
                    var colontmp__14895889 = plusRot_13787251(newPiece_13935001.pos, x_14895858[x_14895858_Idx], y_14895859[y_14895859_Idx], newPiece_13935001.rot);
                    var col_14895864 = colontmp__14895889["Field0"];
                    var row_14895865 = colontmp__14895889["Field1"];
                    if ((contains_13805002(col_14895864) && contains_13810002(row_14895865))) {
                    __13940009 = coord_13785422(col_14895864, row_14895865);
                    }
                    else {
                      outOfBounds_13935002[0] = true;
                      break L11;
                    }
                    
                    i_14895861 += 1;
                  }
              } while(false);
            } while(false);
          } while(false);
          }
          else {
            outOfBounds_13935002[0] = true;
          }
          
          if (outOfBounds_13935002[0]) {
          outOfBounds_13935002[0] = false;
          if (contains_13805002((col0_13935008 + i_13935006))) {
          oneInside_13935010 = true;
          newPiece_13935001.pos = coord_13785422((col0_13935008 + i_13935006), row0_13935009);
          L14: do {
            var __13945009 = 0;
            if (!((newPiece_13935001.kind == 0))) {
            __13945009 = newPiece_13935001.pos;
            }
            
            L15: do {
              var x_14895871 = null;
              var x_14895871_Idx = 0;
              var y_14895872 = null;
              var y_14895872_Idx = 0;
              var colontmp__14895873 = [];
              colontmp__14895873 = pieceExtensions_13785367[newPiece_13935001.kind];
              var i_14895874 = 0;
              var L_14895875 = (colontmp__14895873).length;
              L16: do {
                  L17: while (true) {
                  if (!(i_14895874 < L_14895875)) break L17;
                    x_14895871 = colontmp__14895873[i_14895874]; x_14895871_Idx = "Field0";
                    y_14895872 = colontmp__14895873[i_14895874]; y_14895872_Idx = "Field1";
                    var colontmp__14895890 = plusRot_13787251(newPiece_13935001.pos, x_14895871[x_14895871_Idx], y_14895872[y_14895872_Idx], newPiece_13935001.rot);
                    var col_14895877 = colontmp__14895890["Field0"];
                    var row_14895878 = colontmp__14895890["Field1"];
                    if ((contains_13805002(col_14895877) && contains_13810002(row_14895878))) {
                    __13945009 = coord_13785422(col_14895877, row_14895878);
                    }
                    else {
                      outOfBounds_13935002[0] = true;
                      break L15;
                    }
                    
                    i_14895874 += 1;
                  }
              } while(false);
            } while(false);
          } while(false);
          }
          else {
            outOfBounds_13935002[0] = true;
          }
          
          }
          
          if (oneInside_13935010) {
          i_13935006 += 1;
          }
          else {
            break L8;
          }
          
        }
    } while(false);
    if (outOfBounds_13935002[0]) {
    break BeforeRet;
    }
    
    L18: do {
        L19: while (true) {
        if (!overlaps_13815456(state_13925016.board, newPiece_13935001)) break L19;
          newPiece_13935001.pos = (newPiece_13935001.pos - 10);
        }
    } while(false);
    nimCopy(state_13925016.piece, newPiece_13935001, NTI13785377);
  } while (false);

  
}
function drop_13955014(state_13955016, spawned_13955018, spawned_13955018_Idx) {
    var newPiece_13960001 = nimCopy(null, state_13955016.piece, NTI13785377);
    var maxRow_13960003 = 0;
    L1: do {
      var c_13965001 = 0;
      if (!((state_13955016.piece.kind == 0))) {
      c_13965001 = state_13955016.piece.pos;
      if ((maxRow_13960003 < row_13785517(c_13965001))) {
      maxRow_13960003 = row_13785517(c_13965001);
      }
      
      }
      
      L2: do {
        var x_14895894 = null;
        var x_14895894_Idx = 0;
        var y_14895895 = null;
        var y_14895895_Idx = 0;
        var colontmp__14895896 = [];
        colontmp__14895896 = pieceExtensions_13785367[state_13955016.piece.kind];
        var i_14895897 = 0;
        var L_14895898 = (colontmp__14895896).length;
        L3: do {
            L4: while (true) {
            if (!(i_14895897 < L_14895898)) break L4;
              x_14895894 = colontmp__14895896[i_14895897]; x_14895894_Idx = "Field0";
              y_14895895 = colontmp__14895896[i_14895897]; y_14895895_Idx = "Field1";
              var colontmp__14895914 = plusRot_13787251(state_13955016.piece.pos, x_14895894[x_14895894_Idx], y_14895895[y_14895895_Idx], state_13955016.piece.rot);
              var c_14895900 = colontmp__14895914["Field0"];
              var r_14895901 = colontmp__14895914["Field1"];
              c_13965001 = coord_13785422(c_14895900, r_14895901);
              if ((maxRow_13960003 < row_13785517(c_13965001))) {
              maxRow_13960003 = row_13785517(c_13965001);
              }
              
              i_14895897 += 1;
            }
        } while(false);
      } while(false);
    } while(false);
    if ((maxRow_13960003 == 29)) {
    spawned_13955018[spawned_13955018_Idx] = true;
    }
    else {
      newPiece_13960001.pos = (newPiece_13960001.pos + 10);
      spawned_13955018[spawned_13955018_Idx] = overlaps_13815456(state_13955016.board, newPiece_13960001);
    }
    
    if (spawned_13955018[spawned_13955018_Idx]) {
    if ((state_13955016.pieceDropRetry < state_13955016.pieceDropRetries)) {
    state_13955016.pieceDropRetry += 1;
    }
    else {
      state_13955016.pieceDropRetry = 0;
      state_13955016.justHeld = false;
      L5: do {
        var c_14005001 = 0;
        if (!((state_13955016.piece.kind == 0))) {
        c_14005001 = state_13955016.piece.pos;
        state_13955016.board[c_14005001] = state_13955016.piece.kind;
        }
        
        L6: do {
          var x_14895906 = null;
          var x_14895906_Idx = 0;
          var y_14895907 = null;
          var y_14895907_Idx = 0;
          var colontmp__14895908 = [];
          colontmp__14895908 = pieceExtensions_13785367[state_13955016.piece.kind];
          var i_14895909 = 0;
          var L_14895910 = (colontmp__14895908).length;
          L7: do {
              L8: while (true) {
              if (!(i_14895909 < L_14895910)) break L8;
                x_14895906 = colontmp__14895908[i_14895909]; x_14895906_Idx = "Field0";
                y_14895907 = colontmp__14895908[i_14895909]; y_14895907_Idx = "Field1";
                var colontmp__14895915 = plusRot_13787251(state_13955016.piece.pos, x_14895906[x_14895906_Idx], y_14895907[y_14895907_Idx], state_13955016.piece.rot);
                var c_14895912 = colontmp__14895915["Field0"];
                var r_14895913 = colontmp__14895915["Field1"];
                c_14005001 = coord_13785422(c_14895912, r_14895913);
                state_13955016.board[c_14005001] = state_13955016.piece.kind;
                i_14895909 += 1;
              }
          } while(false);
        } while(false);
      } while(false);
      spawnPiece_13870084(state_13955016, nextPiece_13825222(state_13955016));
    }
    
    }
    else {
      nimCopy(state_13955016.piece, newPiece_13960001, NTI13785377);
    }
    

  
}
function setVolume_12525043(music_12525045, vol_12525046) {
    var vol2_12525048 = HEX2F_2825648(vol_12525046, 128);
    music_12525045.volume = vol2_12525048

  
}
function key_14045024(state_14045026, event_14045027) {
        var Tmp1;
        var Tmp2;
        var Tmp3;
        var Tmp4;
        var Tmp5;
          var Tmp6;
        var Tmp7;
        var Tmp8;
          var Tmp9;
        var Tmp10;
          var Tmp11;
        var Tmp12;
        var Tmp13;
        var Tmp14;
        var Tmp15;
          var Tmp17;
        var Tmp21;
        var Tmp22;
        var Tmp23;
        var Tmp24;
        var Tmp25;
        var Tmp26;
        var Tmp27;
        var Tmp28;
              var Tmp31;
        var Tmp32;

    switch (state_14045026.kind) {
    case 1:
        if (event_14045027.ctrlKey) Tmp3 = true; else {          Tmp3 = event_14045027.metaKey;        }        if (Tmp3) Tmp2 = true; else {          Tmp2 = event_14045027.shiftKey;        }        if (Tmp2) Tmp1 = true; else {          Tmp1 = event_14045027.altKey;        }      if (!(Tmp1)) {
      switch (toJSStr(cstrToNimstr(event_14045027.key))) {
      case "Escape":
        break;
      default: 
        finish_14030066(state_14045026);
        nimCopy(state_14045026, {kind: 2, initial: ({background: null}), tetris: ({board: arrayConstr(300, 0, NTI13745013), nextPieces: [({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0})], piece: ({kind: 0, pos: 0, rot: 0}), pieceDropTicking: false, pieceDropTick: 0, pieceDropTime: 0, pieceDropRetry: 0, pieceDropRetries: 0, holdPiece: ({kind: 0, pos: 0, rot: 0}), justHeld: false})}, NTI14020063);
        init_14020069(state_14045026);
        break;
      }
      }
      
      break;
    case 2:
      switch (toJSStr(cstrToNimstr(event_14045027.key))) {
      case "x":
        var Tmp4 = state_14045026;
        if (ConstSet12[Tmp4.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        rotate_13925014(Tmp4.tetris, true);
        break;
      case "z":
        var Tmp5 = state_14045026;
        if (ConstSet13[Tmp5.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        rotate_13925014(Tmp5.tetris, false);
        break;
      case "c":
          var Tmp6 = state_14045026;
          if (ConstSet14[Tmp6.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        if (!(Tmp6.tetris.justHeld)) {
        var Tmp7 = state_14045026;
        if (ConstSet15[Tmp7.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp7.tetris.justHeld = true;
          var Tmp9 = state_14045026;
          if (ConstSet16[Tmp9.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        if (!((Tmp9.tetris.holdPiece.kind == 0))) {
        var Tmp10 = state_14045026;
        if (ConstSet17[Tmp10.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp8 = Tmp10.tetris.holdPiece;
        }
        else {
          var Tmp11 = state_14045026;
          if (ConstSet18[Tmp11.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp8 = nextPiece_13825222(Tmp11.tetris);
        }
        
        var oldHoldPiece_14090004 = nimCopy(null, Tmp8, NTI13785377);
        var Tmp12 = state_14045026;
        if (ConstSet19[Tmp12.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var Tmp13 = state_14045026;
        if (ConstSet20[Tmp13.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        nimCopy(Tmp12.tetris.holdPiece, Tmp13.tetris.piece, NTI13785377);
        var Tmp14 = state_14045026;
        if (ConstSet21[Tmp14.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var minX_14105002 = column_13785500(Tmp14.tetris.holdPiece.pos);
        var Tmp15 = state_14045026;
        if (ConstSet22[Tmp15.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var minY_14110002 = row_13785517(Tmp15.tetris.holdPiece.pos);
        L16: do {
          var c_14115002 = 0;
          var colontmp__14895817 = ({kind: 0, pos: 0, rot: 0});
          var Tmp17 = state_14045026;
          if (ConstSet23[Tmp17.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
          nimCopy(colontmp__14895817, Tmp17.tetris.holdPiece, NTI13785377);
          if (!((colontmp__14895817.kind == 0))) {
          c_14115002 = colontmp__14895817.pos;
          if ((column_13785500(c_14115002) < minX_14105002)) {
          minX_14105002 = column_13785500(c_14115002);
          }
          
          if ((row_13785517(c_14115002) < minY_14110002)) {
          minY_14110002 = row_13785517(c_14115002);
          }
          
          }
          
          L18: do {
            var x_14895819 = null;
            var x_14895819_Idx = 0;
            var y_14895820 = null;
            var y_14895820_Idx = 0;
            var colontmp__14895821 = [];
            colontmp__14895821 = pieceExtensions_13785367[colontmp__14895817.kind];
            var i_14895822 = 0;
            var L_14895823 = (colontmp__14895821).length;
            L19: do {
                L20: while (true) {
                if (!(i_14895822 < L_14895823)) break L20;
                  x_14895819 = colontmp__14895821[i_14895822]; x_14895819_Idx = "Field0";
                  y_14895820 = colontmp__14895821[i_14895822]; y_14895820_Idx = "Field1";
                  var colontmp__14895891 = plusRot_13787251(colontmp__14895817.pos, x_14895819[x_14895819_Idx], y_14895820[y_14895820_Idx], colontmp__14895817.rot);
                  var c_14895825 = colontmp__14895891["Field0"];
                  var r_14895826 = colontmp__14895891["Field1"];
                  c_14115002 = coord_13785422(c_14895825, r_14895826);
                  if ((column_13785500(c_14115002) < minX_14105002)) {
                  minX_14105002 = column_13785500(c_14115002);
                  }
                  
                  if ((row_13785517(c_14115002) < minY_14110002)) {
                  minY_14110002 = row_13785517(c_14115002);
                  }
                  
                  i_14895822 += 1;
                }
            } while(false);
          } while(false);
        } while(false);
        var Tmp21 = state_14045026;
        if (ConstSet24[Tmp21.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var Tmp22 = state_14045026;
        if (ConstSet25[Tmp22.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var Tmp23 = state_14045026;
        if (ConstSet26[Tmp23.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp21.tetris.holdPiece.pos = coord_13785422((column_13785500(Tmp22.tetris.holdPiece.pos) - minX_14105002), (row_13785517(Tmp23.tetris.holdPiece.pos) - minY_14110002));
        var Tmp24 = state_14045026;
        if (ConstSet27[Tmp24.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        spawnPiece_13870084(Tmp24.tetris, oldHoldPiece_14090004);
        }
        
        break;
      case "ArrowDown":
      case "Down":
        var Tmp25 = state_14045026;
        if (ConstSet28[Tmp25.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp25.tetris.pieceDropTime = 10;
        var Tmp26 = state_14045026;
        if (ConstSet29[Tmp26.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp26.tetris.pieceDropRetries = 3;
        break;
      case "ArrowUp":
      case "Up":
        var Tmp27 = state_14045026;
        if (ConstSet30[Tmp27.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var Tmp28 = state_14045026;
        if (ConstSet31[Tmp28.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp27.tetris.pieceDropRetry = Tmp28.tetris.pieceDropRetries;
        var spawned_14150002 = [false];
        L29: do {
            L30: while (true) {
            if (!!(spawned_14150002[0])) break L30;
              var Tmp31 = state_14045026;
              if (ConstSet32[Tmp31.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
              drop_13955014(Tmp31.tetris, spawned_14150002, 0);
            }
        } while(false);
        var Tmp32 = state_14045026;
        if (ConstSet33[Tmp32.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp32.tetris.pieceDropTick = 0;
        break;
      case "i":
      case "":
        musicVolume_12550203[0] = nimMax(0, (musicVolume_12550203[0] - 16));
        setVolume_12525043(currentMusic_12550201[0], ((musicVolume_12550203[0])|0));
        break;
      case "o":
        musicVolume_12550203[0] = nimMin(128, (musicVolume_12550203[0] + 16));
        setVolume_12525043(currentMusic_12550201[0], ((musicVolume_12550203[0])|0));
        break;
      case "Escape":
        finish_14030066(state_14045026);
        nimCopy(state_14045026, {kind: 1, initial: ({background: null}), tetris: ({board: arrayConstr(300, 0, NTI13745013), nextPieces: [({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0})], piece: ({kind: 0, pos: 0, rot: 0}), pieceDropTicking: false, pieceDropTick: 0, pieceDropTime: 0, pieceDropRetry: 0, pieceDropRetries: 0, holdPiece: ({kind: 0, pos: 0, rot: 0}), justHeld: false})}, NTI14020063);
        init_14020069(state_14045026);
        break;
      default: 
        break;
      }
      break;
    case 3:
      break;
    default: 
      break;
    }

  
}
function keyRepeat_14170046(state_14170048, event_14170049) {
          var Tmp2;
        var Tmp6;
          var Tmp7;
        var Tmp8;
          var Tmp10;
        var Tmp14;
          var Tmp15;
        var Tmp16;

    switch (state_14170048.kind) {
    case 2:
      switch (toJSStr(cstrToNimstr(event_14170049.key))) {
      case "ArrowLeft":
      case "Left":
        var minCol_14175007 = 9;
        L1: do {
          var c_14180002 = 0;
          var colontmp__14895918 = ({kind: 0, pos: 0, rot: 0});
          var Tmp2 = state_14170048;
          if (ConstSet34[Tmp2.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
          nimCopy(colontmp__14895918, Tmp2.tetris.piece, NTI13785377);
          if (!((colontmp__14895918.kind == 0))) {
          c_14180002 = colontmp__14895918.pos;
          if ((column_13785500(c_14180002) < minCol_14175007)) {
          minCol_14175007 = column_13785500(c_14180002);
          }
          
          }
          
          L3: do {
            var x_14895920 = null;
            var x_14895920_Idx = 0;
            var y_14895921 = null;
            var y_14895921_Idx = 0;
            var colontmp__14895922 = [];
            colontmp__14895922 = pieceExtensions_13785367[colontmp__14895918.kind];
            var i_14895923 = 0;
            var L_14895924 = (colontmp__14895922).length;
            L4: do {
                L5: while (true) {
                if (!(i_14895923 < L_14895924)) break L5;
                  x_14895920 = colontmp__14895922[i_14895923]; x_14895920_Idx = "Field0";
                  y_14895921 = colontmp__14895922[i_14895923]; y_14895921_Idx = "Field1";
                  var colontmp__14895943 = plusRot_13787251(colontmp__14895918.pos, x_14895920[x_14895920_Idx], y_14895921[y_14895921_Idx], colontmp__14895918.rot);
                  var c_14895926 = colontmp__14895943["Field0"];
                  var r_14895927 = colontmp__14895943["Field1"];
                  c_14180002 = coord_13785422(c_14895926, r_14895927);
                  if ((column_13785500(c_14180002) < minCol_14175007)) {
                  minCol_14175007 = column_13785500(c_14180002);
                  }
                  
                  i_14895923 += 1;
                }
            } while(false);
          } while(false);
        } while(false);
        if (!((minCol_14175007 == 0))) {
        var Tmp6 = state_14170048;
        if (ConstSet35[Tmp6.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var newPiece_14190002 = nimCopy(null, Tmp6.tetris.piece, NTI13785377);
        newPiece_14190002.pos = (newPiece_14190002.pos - 1);
          var Tmp7 = state_14170048;
          if (ConstSet36[Tmp7.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        if (!(overlaps_13815456(Tmp7.tetris.board, newPiece_14190002))) {
        var Tmp8 = state_14170048;
        if (ConstSet37[Tmp8.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        nimCopy(Tmp8.tetris.piece, newPiece_14190002, NTI13785377);
        }
        
        }
        
        break;
      case "ArrowRight":
      case "Right":
        var maxCol_14200003 = 0;
        L9: do {
          var c_14205002 = 0;
          var colontmp__14895931 = ({kind: 0, pos: 0, rot: 0});
          var Tmp10 = state_14170048;
          if (ConstSet38[Tmp10.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
          nimCopy(colontmp__14895931, Tmp10.tetris.piece, NTI13785377);
          if (!((colontmp__14895931.kind == 0))) {
          c_14205002 = colontmp__14895931.pos;
          if ((maxCol_14200003 < column_13785500(c_14205002))) {
          maxCol_14200003 = column_13785500(c_14205002);
          }
          
          }
          
          L11: do {
            var x_14895933 = null;
            var x_14895933_Idx = 0;
            var y_14895934 = null;
            var y_14895934_Idx = 0;
            var colontmp__14895935 = [];
            colontmp__14895935 = pieceExtensions_13785367[colontmp__14895931.kind];
            var i_14895936 = 0;
            var L_14895937 = (colontmp__14895935).length;
            L12: do {
                L13: while (true) {
                if (!(i_14895936 < L_14895937)) break L13;
                  x_14895933 = colontmp__14895935[i_14895936]; x_14895933_Idx = "Field0";
                  y_14895934 = colontmp__14895935[i_14895936]; y_14895934_Idx = "Field1";
                  var colontmp__14895944 = plusRot_13787251(colontmp__14895931.pos, x_14895933[x_14895933_Idx], y_14895934[y_14895934_Idx], colontmp__14895931.rot);
                  var c_14895939 = colontmp__14895944["Field0"];
                  var r_14895940 = colontmp__14895944["Field1"];
                  c_14205002 = coord_13785422(c_14895939, r_14895940);
                  if ((maxCol_14200003 < column_13785500(c_14205002))) {
                  maxCol_14200003 = column_13785500(c_14205002);
                  }
                  
                  i_14895936 += 1;
                }
            } while(false);
          } while(false);
        } while(false);
        if (!((maxCol_14200003 == 9))) {
        var Tmp14 = state_14170048;
        if (ConstSet39[Tmp14.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var newPiece_14220002 = nimCopy(null, Tmp14.tetris.piece, NTI13785377);
        newPiece_14220002.pos = (newPiece_14220002.pos + 1);
          var Tmp15 = state_14170048;
          if (ConstSet40[Tmp15.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        if (!(overlaps_13815456(Tmp15.tetris.board, newPiece_14220002))) {
        var Tmp16 = state_14170048;
        if (ConstSet41[Tmp16.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        nimCopy(Tmp16.tetris.piece, newPiece_14220002, NTI13785377);
        }
        
        }
        
        break;
      default: 
        break;
      }
      break;
    case 1:
    case 3:
      break;
    default: 
      break;
    }

  
}
function keyReleased_14230015(state_14230017, event_14230018) {
        var Tmp1;
        var Tmp2;

    switch (state_14230017.kind) {
    case 2:
      switch (toJSStr(cstrToNimstr(event_14230018.key))) {
      case "ArrowDown":
      case "Down":
        var Tmp1 = state_14230017;
        if (ConstSet42[Tmp1.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp1.tetris.pieceDropTime = 120;
        var Tmp2 = state_14230017;
        if (ConstSet43[Tmp2.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        Tmp2.tetris.pieceDropRetries = 1;
        break;
      default: 
        break;
      }
      break;
    case 1:
    case 3:
      break;
    default: 
      break;
    }

  
}
function mouse_14245015(state_14245017, event_14245018) {
    switch (state_14245017.kind) {
    case 1:
    case 2:
    case 3:
      break;
    default: 
      break;
    }

  
}
function windowResize_14245032(state_14245034, event_14245035) {
    switch (state_14245034.kind) {
    case 1:
    case 2:
    case 3:
      break;
    default: 
      break;
    }

  
}
function addListeners_14245049(state_14245051) {
    function HEX3Aanonymous_14245052(ev_14245054) {
        var k_14245055 = ev_14245054;
        if (!(k_14245055.repeat)) {
        key_14045024(state_14245051, k_14245055);
        }
        
        keyRepeat_14170046(state_14245051, k_14245055);

      
    }
    function HEX3Aanonymous_14245099(ev_14245101) {
        keyReleased_14230015(state_14245051, ev_14245101);

      
    }
    function HEX3Aanonymous_14245115(ev_14245117) {
        mouse_14245015(state_14245051, ev_14245117);

      
    }
    function HEX3Aanonymous_14245147(ev_14245149) {
        canvas_12550008.width = window.innerWidth;
        canvas_12550008.height = window.innerHeight;
        windowResize_14245032(state_14245051, ev_14245149);

      
    }

    document.body.addEventListener("keydown", HEX3Aanonymous_14245052, false);
    document.body.addEventListener("keyup", HEX3Aanonymous_14245099, false);
    document.body.addEventListener("mousedown", HEX3Aanonymous_14245115, false);
    canvas_12550008.width = window.innerWidth;
    canvas_12550008.height = window.innerHeight;
    window.addEventListener("resize", HEX3Aanonymous_14245147, false);

  
}
function drop_14020014(state_14020016) {
    var spawned_14020047 = [false];
    drop_13955014(state_14020016, spawned_14020047, 0);

  
}
function min_2540014(x_2540016, y_2540017) {
    var Tmp1;
      var Tmp2;

  var result_2540018 = 0.0;

      if ((x_2540016 <= y_2540017)) Tmp2 = true; else {        Tmp2 = !((y_2540017 == y_2540017));      }    if (Tmp2) {
    Tmp1 = x_2540016;
    }
    else {
    Tmp1 = y_2540017;
    }
    
    result_2540018 = Tmp1;

  return result_2540018;

}
function overlapsOrOOB_13820034(board_13820039, piece_13820040) {
        var Tmp2;
                var Tmp6;

  var result_13820041 = [false];

  BeforeRet: do {
    result_13820041[0] = false;
    L1: do {
      var c_13820043 = 0;
      if (!((piece_13820040.kind == 0))) {
      c_13820043 = piece_13820040.pos;
        if (result_13820041[0]) Tmp2 = true; else {          Tmp2 = !((board_13820039[c_13820043] == 0));        }      if (Tmp2) {
      result_13820041[0] = true;
      break BeforeRet;
      }
      
      }
      
      L3: do {
        var x_14896174 = null;
        var x_14896174_Idx = 0;
        var y_14896175 = null;
        var y_14896175_Idx = 0;
        var colontmp__14896176 = [];
        colontmp__14896176 = pieceExtensions_13785367[piece_13820040.kind];
        var i_14896177 = 0;
        var L_14896178 = (colontmp__14896176).length;
        L4: do {
            L5: while (true) {
            if (!(i_14896177 < L_14896178)) break L5;
              x_14896174 = colontmp__14896176[i_14896177]; x_14896174_Idx = "Field0";
              y_14896175 = colontmp__14896176[i_14896177]; y_14896175_Idx = "Field1";
              var colontmp__14896184 = plusRot_13787251(piece_13820040.pos, x_14896174[x_14896174_Idx], y_14896175[y_14896175_Idx], piece_13820040.rot);
              var col_14896180 = colontmp__14896184["Field0"];
              var row_14896181 = colontmp__14896184["Field1"];
              if ((contains_13805002(col_14896180) && contains_13810002(row_14896181))) {
              c_13820043 = coord_13785422(col_14896180, row_14896181);
                if (result_13820041[0]) Tmp6 = true; else {                  Tmp6 = !((board_13820039[c_13820043] == 0));                }              if (Tmp6) {
              result_13820041[0] = true;
              break BeforeRet;
              }
              
              }
              else {
                result_13820041[0] = true;
                break L3;
              }
              
              i_14896177 += 1;
            }
        } while(false);
      } while(false);
    } while(false);
  } while (false);

  return result_13820041[0];

}
function singleLoop_14391307() {
        var Tmp1;
      var Tmp2;
        var Tmp3;
        var Tmp4;
      var Tmp5;
      var Tmp6;
                        var Tmp13;
                        var Tmp14;
                              var Tmp21;
                              var Tmp22;
                                var Tmp23;
                                var Tmp24;
                                var Tmp25;
                                var Tmp26;
        var Tmp29;
      var Tmp33;
        var Tmp35;
        var Tmp37;
        var Tmp48;
      var Tmp49;
        var Tmp50;
        var Tmp51;
      var Tmp52;
        var Tmp53;
        var Tmp54;
        var Tmp56;
        var Tmp61;
                      var Tmp71;
                      var Tmp72;
      var Tmp73;
              var Tmp76;
                var Tmp77;
      var Tmp82;
      var Tmp83;
        var Tmp85;

    switch (game_14245401[0].kind) {
    case 2:
        var Tmp1 = game_14245401[0];
        if (ConstSet44[Tmp1.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      if (Tmp1.tetris.pieceDropTicking) {
      var Tmp2 = game_14245401[0];
      if (ConstSet45[Tmp2.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp2.tetris.pieceDropTick += 1;
        var Tmp3 = game_14245401[0];
        if (ConstSet46[Tmp3.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        var Tmp4 = game_14245401[0];
        if (ConstSet47[Tmp4.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      if ((Math.trunc((Tmp3.tetris.pieceDropTime * fps_12550205[0]) / 120) <= Tmp4.tetris.pieceDropTick)) {
      var Tmp5 = game_14245401[0];
      if (ConstSet48[Tmp5.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      drop_14020014(Tmp5.tetris);
      var Tmp6 = game_14245401[0];
      if (ConstSet49[Tmp6.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp6.tetris.pieceDropTick = 0;
      }
      
      L7: do {
        var r_14430010 = 0;
        var i_14895958 = 0;
        L8: do {
            L9: while (true) {
            if (!(i_14895958 < 30)) break L9;
              r_14430010 = i_14895958;
              var anyEmpty_14430011 = false;
              L10: do {
                var c_14430020 = 0;
                var i_14895947 = 0;
                L11: do {
                    L12: while (true) {
                    if (!(i_14895947 < 10)) break L12;
                      c_14430020 = i_14895947;
                        var Tmp13 = game_14245401[0];
                        if (ConstSet50[Tmp13.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
                      if (((Tmp14 = Tmp13.tetris.board, Tmp14)[coord_13785422(c_14430020, r_14430010)] == 0)) {
                      anyEmpty_14430011 = true;
                      break L10;
                      }
                      
                      i_14895947 += 1;
                    }
                } while(false);
              } while(false);
              if (!(anyEmpty_14430011)) {
              L15: do {
                var ri_14435013 = 0;
                var res_14895953 = r_14430010;
                L16: do {
                    L17: while (true) {
                    if (!(0 <= res_14895953)) break L17;
                      ri_14435013 = res_14895953;
                      L18: do {
                        var ci_14435022 = 0;
                        var i_14895951 = 0;
                        L19: do {
                            L20: while (true) {
                            if (!(i_14895951 < 10)) break L20;
                              ci_14435022 = i_14895951;
                              if ((ri_14435013 == 0)) {
                              var Tmp21 = game_14245401[0];
                              if (ConstSet51[Tmp21.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
                              (Tmp22 = Tmp21.tetris.board, Tmp22)[coord_13785422(ci_14435022, ri_14435013)] = 0;
                              }
                              else {
                                var Tmp23 = game_14245401[0];
                                if (ConstSet52[Tmp23.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
                                var Tmp25 = game_14245401[0];
                                if (ConstSet53[Tmp25.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
                                var Tmp27 = (Tmp24 = Tmp23.tetris.board, Tmp24)[coord_13785422(ci_14435022, ri_14435013)]; (Tmp24 = Tmp23.tetris.board, Tmp24)[coord_13785422(ci_14435022, ri_14435013)] = (Tmp26 = Tmp25.tetris.board, Tmp26)[coord_13785422(ci_14435022, (ri_14435013 - 1))]; (Tmp26 = Tmp25.tetris.board, Tmp26)[coord_13785422(ci_14435022, (ri_14435013 - 1))] = Tmp27;                              }
                              
                              i_14895951 += 1;
                            }
                        } while(false);
                      } while(false);
                      res_14895953 -= 1;
                    }
                } while(false);
              } while(false);
              }
              
              i_14895958 += 1;
            }
        } while(false);
      } while(false);
      var maxRow_14450010 = 0;
      L28: do {
        var c_14455002 = 0;
        var colontmp__14895961 = ({kind: 0, pos: 0, rot: 0});
        var Tmp29 = game_14245401[0];
        if (ConstSet54[Tmp29.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        nimCopy(colontmp__14895961, Tmp29.tetris.piece, NTI13785377);
        if (!((colontmp__14895961.kind == 0))) {
        c_14455002 = colontmp__14895961.pos;
        if ((maxRow_14450010 < row_13785517(c_14455002))) {
        maxRow_14450010 = row_13785517(c_14455002);
        }
        
        }
        
        L30: do {
          var x_14895963 = null;
          var x_14895963_Idx = 0;
          var y_14895964 = null;
          var y_14895964_Idx = 0;
          var colontmp__14895965 = [];
          colontmp__14895965 = pieceExtensions_13785367[colontmp__14895961.kind];
          var i_14895966 = 0;
          var L_14895967 = (colontmp__14895965).length;
          L31: do {
              L32: while (true) {
              if (!(i_14895966 < L_14895967)) break L32;
                x_14895963 = colontmp__14895965[i_14895966]; x_14895963_Idx = "Field0";
                y_14895964 = colontmp__14895965[i_14895966]; y_14895964_Idx = "Field1";
                var colontmp__14896166 = plusRot_13787251(colontmp__14895961.pos, x_14895963[x_14895963_Idx], y_14895964[y_14895964_Idx], colontmp__14895961.rot);
                var c_14895969 = colontmp__14896166["Field0"];
                var r_14895970 = colontmp__14896166["Field1"];
                c_14455002 = coord_13785422(c_14895969, r_14895970);
                if ((maxRow_14450010 < row_13785517(c_14455002))) {
                maxRow_14450010 = row_13785517(c_14455002);
                }
                
                i_14895966 += 1;
              }
          } while(false);
        } while(false);
      } while(false);
      if ((maxRow_14450010 < 10)) {
      finish_14030066(game_14245401[0]);
      nimCopy(game_14245401[0], {kind: 1, initial: ({background: null}), tetris: ({board: arrayConstr(300, 0, NTI13745013), nextPieces: [({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0})], piece: ({kind: 0, pos: 0, rot: 0}), pieceDropTicking: false, pieceDropTick: 0, pieceDropTime: 0, pieceDropRetry: 0, pieceDropRetries: 0, holdPiece: ({kind: 0, pos: 0, rot: 0}), justHeld: false})}, NTI14020063);
      init_14020069(game_14245401[0]);
      }
      
      }
      
      break;
    case 1:
    case 3:
      break;
    default: 
      break;
    }
    context_12550009.fillStyle = "#00000000";
    context_12550009.strokeStyle = "#00000000";
    context_12550009.clearRect(0, 0, canvas_12550008.width, canvas_12550008.height);
    var windowWidth_14485003 = ((canvas_12550008.width)|0);
    var windowHeight_14485004 = ((canvas_12550008.height)|0);
    switch (game_14245401[0].kind) {
    case 1:
      var Tmp33 = game_14245401[0];
      if (ConstSet55[Tmp33.kind]===undefined) { raiseFieldError(makeNimstrLit("\'initial\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      context_12550009.drawImage(Tmp33.initial.background, 0, 0, windowWidth_14485003, windowHeight_14485004);
      break;
    case 2:
      L34: do {
        var a_14500057 = HEX2F_2825648(((windowWidth_14485003)|0), 960);
        var b_14500058 = HEX2F_2825648(((windowHeight_14485004)|0), 540);
        if (!((a_14500057 == b_14500058))) {
        var newRatio_14505001 = min_2540014(a_14500057, b_14500058);
        Tmp35 = {Field0: (newRatio_14505001 * 9.6000000000000000e+002), Field1: (newRatio_14505001 * 5.4000000000000000e+002)};
        }
        else {
        Tmp35 = {Field0: windowWidth_14485003, Field1: windowHeight_14485004};
        }
        
      } while(false);
      var colontmp__14896167 = nimCopy(null, Tmp35, NTI14505002);
      var scaledWindowWidth_14505004 = colontmp__14896167["Field0"];
      var scaledWindowHeight_14505005 = colontmp__14896167["Field1"];
      var startX_14505006 = ((windowWidth_14485003 - scaledWindowWidth_14505004) / 2.0000000000000000e+000);
      var startY_14505007 = ((windowHeight_14485004 - scaledWindowHeight_14505005) / 2.0000000000000000e+000);
      var scaledTileWidth_14515001 = ((Math.ceil(((2.7000000000000000e+001 * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
      var scaledTileHeight_14520001 = ((Math.ceil(((2.7000000000000000e+001 * scaledWindowHeight_14505005) / 5.4000000000000000e+002)))|0);
      context_12550009.fillStyle = "rgba(80,80,80,1.0)";
      context_12550009.strokeStyle = "rgba(80,80,80,1.0)";
      context_12550009.beginPath();
      context_12550009.rect((((((startX_14505006)|0) + ((((7.0700000000000000e+002 * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0), (((startY_14505007 + ((4.5000000000000000e+001 * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0), ((Math.ceil(((7.5000000000000000e+001 * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0), ((Math.ceil(((2.5500000000000000e+002 * scaledWindowHeight_14505005) / 5.4000000000000000e+002)))|0));
      context_12550009.stroke();
      L36: do {
        var i_14565066 = 0;
        var p_14565067 = ({kind: 0, pos: 0, rot: 0});
        var colontmp__14896033 = [({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0}), ({kind: 0, pos: 0, rot: 0})];
        var Tmp37 = game_14245401[0];
        if (ConstSet56[Tmp37.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        nimCopy(colontmp__14896033, Tmp37.tetris.nextPieces, NTI13825211);
        var i_14896038 = 0;
        if ((i_14896038 <= 3)) {
        L38: do {
            L39: while (true) {
            if (!true) break L39;
              i_14565066 = i_14896038;
              nimCopy(p_14565067, colontmp__14896033[i_14896038], NTI13785377);
              context_12550009.fillStyle = pieceColors_13785202[p_14565067.kind];
              context_12550009.strokeStyle = pieceColors_13785202[p_14565067.kind];
              var maxX_14570002 = 0;
              var maxY_14570003 = 0;
              L40: do {
                var c_14570004 = 0;
                if (!((p_14565067.kind == 0))) {
                c_14570004 = p_14565067.pos;
                if ((maxX_14570002 < column_13785500(c_14570004))) {
                maxX_14570002 = column_13785500(c_14570004);
                }
                
                if ((maxY_14570003 < row_13785517(c_14570004))) {
                maxY_14570003 = row_13785517(c_14570004);
                }
                
                }
                
                L41: do {
                  var x_14895999 = null;
                  var x_14895999_Idx = 0;
                  var y_14896000 = null;
                  var y_14896000_Idx = 0;
                  var colontmp__14896001 = [];
                  colontmp__14896001 = pieceExtensions_13785367[p_14565067.kind];
                  var i_14896002 = 0;
                  var L_14896003 = (colontmp__14896001).length;
                  L42: do {
                      L43: while (true) {
                      if (!(i_14896002 < L_14896003)) break L43;
                        x_14895999 = colontmp__14896001[i_14896002]; x_14895999_Idx = "Field0";
                        y_14896000 = colontmp__14896001[i_14896002]; y_14896000_Idx = "Field1";
                        var colontmp__14896168 = plusRot_13787251(p_14565067.pos, x_14895999[x_14895999_Idx], y_14896000[y_14896000_Idx], p_14565067.rot);
                        var c_14896005 = colontmp__14896168["Field0"];
                        var r_14896006 = colontmp__14896168["Field1"];
                        c_14570004 = coord_13785422(c_14896005, r_14896006);
                        if ((maxX_14570002 < column_13785500(c_14570004))) {
                        maxX_14570002 = column_13785500(c_14570004);
                        }
                        
                        if ((maxY_14570003 < row_13785517(c_14570004))) {
                        maxY_14570003 = row_13785517(c_14570004);
                        }
                        
                        i_14896002 += 1;
                      }
                  } while(false);
                } while(false);
              } while(false);
              var width_14580003 = (maxX_14570002 + 1);
              var height_14580004 = (maxY_14570003 + 1);
              var unit_14580005 = (4.5000000000000000e+001 / nimMax(width_14580003, height_14580004));
              var tileWidth_14585001 = ((Math.ceil(((unit_14580005 * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
              var tileHeight_14590001 = ((Math.ceil(((unit_14580005 * scaledWindowHeight_14505005) / 5.4000000000000000e+002)))|0);
              var tileXStart_14590002 = (7.2200000000000000e+002 + ((4.5000000000000000e+001 - (width_14580003 * unit_14580005)) / 2.0000000000000000e+000));
              var tileYStart_14590003 = ((6.0000000000000000e+001 + (i_14565066 * 6.0000000000000000e+001)) + ((4.5000000000000000e+001 - (height_14580004 * unit_14580005)) / 2.0000000000000000e+000));
              L44: do {
                var c_14590004 = 0;
                if (!((p_14565067.kind == 0))) {
                c_14590004 = p_14565067.pos;
                var x_14600001 = (((startX_14505006 + ((((column_13785500(c_14590004) * unit_14580005) + tileXStart_14590002) * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
                var y_14610001 = (((startY_14505007 + ((((row_13785517(c_14590004) * unit_14580005) + tileYStart_14590003) * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
                context_12550009.fillRect(x_14600001, y_14610001, tileWidth_14585001, tileHeight_14590001);
                }
                
                L45: do {
                  var x_14896019 = null;
                  var x_14896019_Idx = 0;
                  var y_14896020 = null;
                  var y_14896020_Idx = 0;
                  var colontmp__14896021 = [];
                  colontmp__14896021 = pieceExtensions_13785367[p_14565067.kind];
                  var i_14896022 = 0;
                  var L_14896023 = (colontmp__14896021).length;
                  L46: do {
                      L47: while (true) {
                      if (!(i_14896022 < L_14896023)) break L47;
                        x_14896019 = colontmp__14896021[i_14896022]; x_14896019_Idx = "Field0";
                        y_14896020 = colontmp__14896021[i_14896022]; y_14896020_Idx = "Field1";
                        var colontmp__14896169 = plusRot_13787251(p_14565067.pos, x_14896019[x_14896019_Idx], y_14896020[y_14896020_Idx], p_14565067.rot);
                        var c_14896025 = colontmp__14896169["Field0"];
                        var r_14896026 = colontmp__14896169["Field1"];
                        c_14590004 = coord_13785422(c_14896025, r_14896026);
                        var x_14896027 = (((startX_14505006 + ((((column_13785500(c_14590004) * unit_14580005) + tileXStart_14590002) * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
                        var y_14896030 = (((startY_14505007 + ((((row_13785517(c_14590004) * unit_14580005) + tileYStart_14590003) * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
                        context_12550009.fillRect(x_14896027, y_14896030, tileWidth_14585001, tileHeight_14590001);
                        i_14896022 += 1;
                      }
                  } while(false);
                } while(false);
              } while(false);
              if ((3 <= i_14896038)) {
              break L38;
              }
              
              i_14896038 += 1;
            }
        } while(false);
        }
        
      } while(false);
      context_12550009.fillStyle = "rgba(80,80,80,1.0)";
      context_12550009.strokeStyle = "rgba(80,80,80,1.0)";
      context_12550009.beginPath();
      context_12550009.rect((((startX_14505006 + ((1.9500000000000000e+002 * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0), (((startY_14505007 + ((4.5000000000000000e+001 * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0), ((Math.ceil(((7.5000000000000000e+001 * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0), ((Math.ceil(((7.5000000000000000e+001 * scaledWindowHeight_14505005) / 5.4000000000000000e+002)))|0));
      context_12550009.stroke();
        var Tmp48 = game_14245401[0];
        if (ConstSet57[Tmp48.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      if (!((Tmp48.tetris.holdPiece.kind == 0))) {
        var Tmp50 = game_14245401[0];
        if (ConstSet58[Tmp50.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      if (Tmp50.tetris.justHeld) {
      Tmp49 = "rgba(60,60,60,1.0)";
      }
      else {
        var Tmp51 = game_14245401[0];
        if (ConstSet59[Tmp51.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp49 = pieceColors_13785202[Tmp51.tetris.holdPiece.kind];
      }
      
      context_12550009.fillStyle = Tmp49;
        var Tmp53 = game_14245401[0];
        if (ConstSet60[Tmp53.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      if (Tmp53.tetris.justHeld) {
      Tmp52 = "rgba(60,60,60,1.0)";
      }
      else {
        var Tmp54 = game_14245401[0];
        if (ConstSet61[Tmp54.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      Tmp52 = pieceColors_13785202[Tmp54.tetris.holdPiece.kind];
      }
      
      context_12550009.strokeStyle = Tmp52;
      var maxX_14685002 = 0;
      var maxY_14685003 = 0;
      L55: do {
        var c_14690002 = 0;
        var colontmp__14896049 = ({kind: 0, pos: 0, rot: 0});
        var Tmp56 = game_14245401[0];
        if (ConstSet62[Tmp56.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        nimCopy(colontmp__14896049, Tmp56.tetris.holdPiece, NTI13785377);
        if (!((colontmp__14896049.kind == 0))) {
        c_14690002 = colontmp__14896049.pos;
        if ((maxX_14685002 < column_13785500(c_14690002))) {
        maxX_14685002 = column_13785500(c_14690002);
        }
        
        if ((maxY_14685003 < row_13785517(c_14690002))) {
        maxY_14685003 = row_13785517(c_14690002);
        }
        
        }
        
        L57: do {
          var x_14896051 = null;
          var x_14896051_Idx = 0;
          var y_14896052 = null;
          var y_14896052_Idx = 0;
          var colontmp__14896053 = [];
          colontmp__14896053 = pieceExtensions_13785367[colontmp__14896049.kind];
          var i_14896054 = 0;
          var L_14896055 = (colontmp__14896053).length;
          L58: do {
              L59: while (true) {
              if (!(i_14896054 < L_14896055)) break L59;
                x_14896051 = colontmp__14896053[i_14896054]; x_14896051_Idx = "Field0";
                y_14896052 = colontmp__14896053[i_14896054]; y_14896052_Idx = "Field1";
                var colontmp__14896170 = plusRot_13787251(colontmp__14896049.pos, x_14896051[x_14896051_Idx], y_14896052[y_14896052_Idx], colontmp__14896049.rot);
                var c_14896057 = colontmp__14896170["Field0"];
                var r_14896058 = colontmp__14896170["Field1"];
                c_14690002 = coord_13785422(c_14896057, r_14896058);
                if ((maxX_14685002 < column_13785500(c_14690002))) {
                maxX_14685002 = column_13785500(c_14690002);
                }
                
                if ((maxY_14685003 < row_13785517(c_14690002))) {
                maxY_14685003 = row_13785517(c_14690002);
                }
                
                i_14896054 += 1;
              }
          } while(false);
        } while(false);
      } while(false);
      var width_14700002 = (maxX_14685002 + 1);
      var height_14700003 = (maxY_14685003 + 1);
      var unit_14700004 = (4.5000000000000000e+001 / nimMax(width_14700002, height_14700003));
      var tileWidth_14705001 = ((Math.ceil(((unit_14700004 * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
      var tileHeight_14710001 = ((Math.ceil(((unit_14700004 * scaledWindowHeight_14505005) / 5.4000000000000000e+002)))|0);
      var tileXStart_14710002 = (2.1000000000000000e+002 + ((4.5000000000000000e+001 - (width_14700002 * unit_14700004)) / 2.0000000000000000e+000));
      var tileYStart_14710003 = (6.0000000000000000e+001 + ((4.5000000000000000e+001 - (height_14700003 * unit_14700004)) / 2.0000000000000000e+000));
      L60: do {
        var c_14715002 = 0;
        var colontmp__14896069 = ({kind: 0, pos: 0, rot: 0});
        var Tmp61 = game_14245401[0];
        if (ConstSet63[Tmp61.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        nimCopy(colontmp__14896069, Tmp61.tetris.holdPiece, NTI13785377);
        if (!((colontmp__14896069.kind == 0))) {
        c_14715002 = colontmp__14896069.pos;
        var x_14725001 = (((startX_14505006 + ((((column_13785500(c_14715002) * unit_14700004) + tileXStart_14710002) * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
        var y_14735001 = (((startY_14505007 + ((((row_13785517(c_14715002) * unit_14700004) + tileYStart_14710003) * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
        context_12550009.fillRect(x_14725001, y_14735001, tileWidth_14705001, tileHeight_14710001);
        }
        
        L62: do {
          var x_14896071 = null;
          var x_14896071_Idx = 0;
          var y_14896072 = null;
          var y_14896072_Idx = 0;
          var colontmp__14896073 = [];
          colontmp__14896073 = pieceExtensions_13785367[colontmp__14896069.kind];
          var i_14896074 = 0;
          var L_14896075 = (colontmp__14896073).length;
          L63: do {
              L64: while (true) {
              if (!(i_14896074 < L_14896075)) break L64;
                x_14896071 = colontmp__14896073[i_14896074]; x_14896071_Idx = "Field0";
                y_14896072 = colontmp__14896073[i_14896074]; y_14896072_Idx = "Field1";
                var colontmp__14896171 = plusRot_13787251(colontmp__14896069.pos, x_14896071[x_14896071_Idx], y_14896072[y_14896072_Idx], colontmp__14896069.rot);
                var c_14896077 = colontmp__14896171["Field0"];
                var r_14896078 = colontmp__14896171["Field1"];
                c_14715002 = coord_13785422(c_14896077, r_14896078);
                var x_14896079 = (((startX_14505006 + ((((column_13785500(c_14715002) * unit_14700004) + tileXStart_14710002) * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
                var y_14896082 = (((startY_14505007 + ((((row_13785517(c_14715002) * unit_14700004) + tileYStart_14710003) * scaledWindowWidth_14505004) / 9.6000000000000000e+002)))|0);
                context_12550009.fillRect(x_14896079, y_14896082, tileWidth_14705001, tileHeight_14710001);
                i_14896074 += 1;
              }
          } while(false);
        } while(false);
      } while(false);
      }
      
      L65: do {
        var rowI_14740020 = 0;
        var i_14896101 = 10;
        L66: do {
            L67: while (true) {
            if (!(i_14896101 < 30)) break L67;
              rowI_14740020 = i_14896101;
              L68: do {
                var colI_14740029 = 0;
                var i_14896099 = 0;
                L69: do {
                    L70: while (true) {
                    if (!(i_14896099 < 10)) break L70;
                      colI_14740029 = i_14896099;
                      var Tmp71 = game_14245401[0];
                      if (ConstSet64[Tmp71.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
                      var p_14745002 = (Tmp72 = Tmp71.tetris.board, Tmp72)[coord_13785422(colI_14740029, rowI_14740020)];
                      var x_14755001 = (((((startX_14505006)|0) + ((((((colI_14740029 * 27) + 345) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
                      var y_14765001 = (((((startY_14505007)|0) + ((((((rowI_14740020 - 10) * 27) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
                      if (!((p_14745002 == 0))) {
                      context_12550009.fillStyle = pieceColors_13785202[p_14745002];
                      context_12550009.strokeStyle = pieceColors_13785202[p_14745002];
                      context_12550009.fillRect(x_14755001, y_14765001, scaledTileWidth_14515001, scaledTileHeight_14520001);
                      }
                      
                      context_12550009.fillStyle = "rgba(80,80,80,1.0)";
                      context_12550009.strokeStyle = "rgba(80,80,80,1.0)";
                      context_12550009.beginPath();
                      context_12550009.rect(x_14755001, y_14765001, scaledTileWidth_14515001, scaledTileHeight_14520001);
                      context_12550009.stroke();
                      i_14896099 += 1;
                    }
                } while(false);
              } while(false);
              i_14896101 += 1;
            }
        } while(false);
      } while(false);
      var Tmp73 = game_14245401[0];
      if (ConstSet65[Tmp73.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      var shadowPiece_14795002 = nimCopy(null, Tmp73.tetris.piece, NTI13785377);
      L74: do {
          L75: while (true) {
          if (!true) break L75;
            var oldPos_14795003 = shadowPiece_14795002.pos;
            var newRow_14795004 = (row_13785517(oldPos_14795003) + 1);
              if (!(contains_13810002(newRow_14795004))) Tmp76 = true; else {                shadowPiece_14795002.pos = coord_13785422(column_13785500(oldPos_14795003), newRow_14795004);
                var Tmp77 = game_14245401[0];
                if (ConstSet66[Tmp77.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
                Tmp76 = overlapsOrOOB_13820034(Tmp77.tetris.board, shadowPiece_14795002);              }            if (Tmp76) {
            shadowPiece_14795002.pos = oldPos_14795003;
            break L74;
            }
            
          }
      } while(false);
      context_12550009.fillStyle = "rgba(200,200,200,1.0)";
      context_12550009.strokeStyle = "rgba(200,200,200,1.0)";
      L78: do {
        var c_14815001 = 0;
        if (!((shadowPiece_14795002.kind == 0))) {
        c_14815001 = shadowPiece_14795002.pos;
        if ((10 <= row_13785517(c_14815001))) {
        var x_14830001 = (((((startX_14505006)|0) + ((((((column_13785500(c_14815001) * 27) + 345) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
        var y_14840001 = (((((startY_14505007)|0) + ((((((row_13785517(c_14815001) - 10) * 27) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
        context_12550009.fillRect(x_14830001, y_14840001, scaledTileWidth_14515001, scaledTileHeight_14520001);
        }
        
        }
        
        L79: do {
          var x_14896117 = null;
          var x_14896117_Idx = 0;
          var y_14896118 = null;
          var y_14896118_Idx = 0;
          var colontmp__14896119 = [];
          colontmp__14896119 = pieceExtensions_13785367[shadowPiece_14795002.kind];
          var i_14896120 = 0;
          var L_14896121 = (colontmp__14896119).length;
          L80: do {
              L81: while (true) {
              if (!(i_14896120 < L_14896121)) break L81;
                x_14896117 = colontmp__14896119[i_14896120]; x_14896117_Idx = "Field0";
                y_14896118 = colontmp__14896119[i_14896120]; y_14896118_Idx = "Field1";
                var colontmp__14896185 = plusRot_13787251(shadowPiece_14795002.pos, x_14896117[x_14896117_Idx], y_14896118[y_14896118_Idx], shadowPiece_14795002.rot);
                var c_14896123 = colontmp__14896185["Field0"];
                var r_14896124 = colontmp__14896185["Field1"];
                c_14815001 = coord_13785422(c_14896123, r_14896124);
                if ((10 <= row_13785517(c_14815001))) {
                var x_14896125 = (((((startX_14505006)|0) + ((((((column_13785500(c_14815001) * 27) + 345) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
                var y_14896130 = (((((startY_14505007)|0) + ((((((row_13785517(c_14815001) - 10) * 27) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
                context_12550009.fillRect(x_14896125, y_14896130, scaledTileWidth_14515001, scaledTileHeight_14520001);
                }
                
                i_14896120 += 1;
              }
          } while(false);
        } while(false);
      } while(false);
      var Tmp82 = game_14245401[0];
      if (ConstSet67[Tmp82.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      context_12550009.fillStyle = pieceColors_13785202[Tmp82.tetris.piece.kind];
      var Tmp83 = game_14245401[0];
      if (ConstSet68[Tmp83.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
      context_12550009.strokeStyle = pieceColors_13785202[Tmp83.tetris.piece.kind];
      L84: do {
        var c_14860002 = 0;
        var colontmp__14896146 = ({kind: 0, pos: 0, rot: 0});
        var Tmp85 = game_14245401[0];
        if (ConstSet69[Tmp85.kind]===undefined) { raiseFieldError(makeNimstrLit("\'tetris\' is not accessible using discriminant \'kind\' of type \'GameObj\'")); }
        nimCopy(colontmp__14896146, Tmp85.tetris.piece, NTI13785377);
        if (!((colontmp__14896146.kind == 0))) {
        c_14860002 = colontmp__14896146.pos;
        if ((10 <= row_13785517(c_14860002))) {
        var x_14875001 = (((((startX_14505006)|0) + ((((((column_13785500(c_14860002) * 27) + 345) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
        var y_14885001 = (((((startY_14505007)|0) + ((((((row_13785517(c_14860002) - 10) * 27) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
        context_12550009.fillRect(x_14875001, y_14885001, scaledTileWidth_14515001, scaledTileHeight_14520001);
        }
        
        }
        
        L86: do {
          var x_14896148 = null;
          var x_14896148_Idx = 0;
          var y_14896149 = null;
          var y_14896149_Idx = 0;
          var colontmp__14896150 = [];
          colontmp__14896150 = pieceExtensions_13785367[colontmp__14896146.kind];
          var i_14896151 = 0;
          var L_14896152 = (colontmp__14896150).length;
          L87: do {
              L88: while (true) {
              if (!(i_14896151 < L_14896152)) break L88;
                x_14896148 = colontmp__14896150[i_14896151]; x_14896148_Idx = "Field0";
                y_14896149 = colontmp__14896150[i_14896151]; y_14896149_Idx = "Field1";
                var colontmp__14896186 = plusRot_13787251(colontmp__14896146.pos, x_14896148[x_14896148_Idx], y_14896149[y_14896149_Idx], colontmp__14896146.rot);
                var c_14896154 = colontmp__14896186["Field0"];
                var r_14896155 = colontmp__14896186["Field1"];
                c_14860002 = coord_13785422(c_14896154, r_14896155);
                if ((10 <= row_13785517(c_14860002))) {
                var x_14896156 = (((((startX_14505006)|0) + ((((((column_13785500(c_14860002) * 27) + 345) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
                var y_14896161 = (((((startY_14505007)|0) + ((((((row_13785517(c_14860002) - 10) * 27) * scaledWindowHeight_14505005) / 5.4000000000000000e+002))|0)))|0);
                context_12550009.fillRect(x_14896156, y_14896161, scaledTileWidth_14515001, scaledTileHeight_14520001);
                }
                
                i_14896151 += 1;
              }
          } while(false);
        } while(false);
      } while(false);
      break;
    case 3:
      break;
    default: 
      break;
    }
    numTicks_12550204[0] += 1;

  
}
async function mainLoop_14895001() {
    function foo_14895203(timestamp_14895205) {
        fps_12550205[0] = (((1.0000000000000000e+003 / (timestamp_14895205 - lastTimestamp_14895201)))|0);
        singleLoop_14391307();
        lastTimestamp_14895201 = timestamp_14895205;
        var _ = window.requestAnimationFrame(foo_14895203);

      
    }

  var result_14895007 = null;

  BeforeRet: do {
    var lastTimestamp_14895201 = 0.0;
    addListeners_14245049(game_14245401[0]);
    var _ = window.requestAnimationFrame(foo_14895203);
    result_14895007 = undefined;
    break BeforeRet;
  } while (false);

  return result_14895007;

}
var _ = mainLoop_14895001();
